<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ClothSimulation: GLWindow.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>GLWindow.cpp</h1><a href="_g_l_window_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="_g_l_window_8h.html" title="a basic Qt GL window class where all the drawing and updating of objects takes place...">GLWindow.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;ngl/Light.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;ngl/Mat4.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;ngl/Transformation.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;ngl/Material.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;ngl/NGLInit.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;ngl/Obj.h&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;ngl/Random.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;ngl/VAOPrimitives.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;ngl/ShaderLib.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;boost/foreach.hpp&gt;</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00017"></a>00017 <span class="comment"></span><span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00018"></a><a class="code" href="class_g_l_window.html#aff6ed801e0ce3f17da2355461d812d48">00018</a> <a class="code" href="class_g_l_window.html#aff6ed801e0ce3f17da2355461d812d48" title="Constructor for GLWindow.">GLWindow::GLWindow</a>(
<a name="l00019"></a>00019         <span class="keywordtype">int</span> _timer,
<a name="l00020"></a>00020                                     QWidget *_parent
<a name="l00021"></a>00021                   ) : QGLWidget( new CreateCoreGLContext(QGLFormat::defaultFormat()), _parent )
<a name="l00022"></a>00022 {
<a name="l00023"></a>00023 
<a name="l00024"></a>00024      <span class="comment">// set this widget to have the initial keyboard focus</span>
<a name="l00025"></a>00025      setFocus();
<a name="l00026"></a>00026      <span class="comment">// re-size the widget to that of the parent (in this case the GLFrame passed in on construction)</span>
<a name="l00027"></a>00027      this-&gt;resize(_parent-&gt;size());
<a name="l00028"></a>00028      <span class="comment">// Now set the initial GLWindow attributes to default values</span>
<a name="l00029"></a>00029      <span class="comment">// Roate is false</span>
<a name="l00030"></a>00030      <a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a>=<span class="keyword">false</span>;
<a name="l00031"></a>00031      <span class="comment">// mouse rotation values set to 0</span>
<a name="l00032"></a>00032      <a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>=0;
<a name="l00033"></a>00033      <a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>=0;
<a name="l00034"></a>00034      <a class="code" href="class_g_l_window.html#a2e3710bf09e4710291b3044e6744d897" title="the timer value in ms">m_timerValue</a>=_timer;
<a name="l00035"></a>00035      <a class="code" href="class_g_l_window.html#aff50e08e7eadb0f5a124d86873b98674" title="start the simulation timer">startSimTimer</a>();
<a name="l00036"></a>00036      <a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a>=<span class="keyword">false</span>;
<a name="l00037"></a>00037      <a class="code" href="class_g_l_window.html#a73f75e2715ec333f4ab05281e5862f37">m_sphereCollision</a>=<span class="keyword">false</span>;
<a name="l00038"></a>00038      <a class="code" href="class_g_l_window.html#af6244a13882c36f6c20c90e96f0edfdc">m_tableCollision</a> = <span class="keyword">false</span>;
<a name="l00039"></a>00039      <a class="code" href="class_g_l_window.html#a7687d94368fa3512f2ee0fc747a149b7">m_draw</a> = <span class="keyword">false</span>;
<a name="l00040"></a>00040      <a class="code" href="class_g_l_window.html#ad1eb426f714658ab6fc01b3b76f65707">m_reset</a>=<span class="keyword">true</span>;
<a name="l00041"></a>00041      <a class="code" href="class_g_l_window.html#a401a0d7eeee6f4b21c5e6e501842e36c" title="variable to recieve user input for number of cloth partiles">m_cp</a> = 10.0f;
<a name="l00042"></a>00042      <a class="code" href="class_g_l_window.html#a94d88d543a8bd1055ef3986429aece00">clothtex</a> = <span class="stringliteral">&quot;texture/table.png&quot;</span>;
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="class_g_l_window.html#a2eeaea2148f4f72344edd6d1bac9759b">00045</a> <a class="code" href="class_g_l_window.html#a2eeaea2148f4f72344edd6d1bac9759b" title="dtor">GLWindow::~GLWindow</a>()
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047     ngl::NGLInit *init = ngl::NGLInit::instance();
<a name="l00048"></a>00048     init-&gt;NGLQuit();
<a name="l00049"></a>00049 }
<a name="l00050"></a>00050 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00051"></a>00051 <span class="comment">// This virtual function is called once before the first call to paintGL() or resizeGL(),</span>
<a name="l00052"></a>00052 <span class="comment">//and then once whenever the widget has been assigned a new QGLContext.</span>
<a name="l00053"></a>00053 <span class="comment">// This function should set up any required OpenGL context rendering flags, defining display lists, etc.</span>
<a name="l00054"></a>00054 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00055"></a><a class="code" href="class_g_l_window.html#a39e39761cd7323806917a217cc7caea5">00055</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a39e39761cd7323806917a217cc7caea5" title="The following methods must be implimented in the sub class this is called when the...">GLWindow::initializeGL</a>()
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 glClearColor(0.4f, 0.4f, 0.4f, 1.0f);        <span class="comment">// Grey Background</span>
<a name="l00059"></a>00059 <span class="comment">// enable depth testing for drawing</span>
<a name="l00060"></a>00060  glEnable(GL_DEPTH_TEST);
<a name="l00061"></a>00061  <span class="comment">// Now we will create a basic Camera from the graphics library</span>
<a name="l00062"></a>00062  <span class="comment">// This is a static camera so it only needs to be set once</span>
<a name="l00063"></a>00063  <span class="comment">// First create Values for the camera position</span>
<a name="l00064"></a>00064  <span class="comment">//ngl::Vec3 from(0,0,20);</span>
<a name="l00065"></a>00065  ngl::Vec3 from(-10,5,30);
<a name="l00066"></a>00066  ngl::Vec3 to(0,0,0);
<a name="l00067"></a>00067  ngl::Vec3 up(0,1,0);
<a name="l00068"></a>00068  ngl::NGLInit *Init = ngl::NGLInit::instance();
<a name="l00069"></a>00069 <span class="preprocessor"> #ifdef WIN32</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>  glewInit();
<a name="l00071"></a>00071 <span class="preprocessor"> #endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span> Init-&gt;initGlew();
<a name="l00073"></a>00073  <a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>= <span class="keyword">new</span> ngl::Camera(from,to,up,ngl::PERSPECTIVE);
<a name="l00074"></a>00074  <span class="comment">// set the shape using FOV 45 Aspect Ratio based on Width and Height</span>
<a name="l00075"></a>00075  <span class="comment">// The final two are near and far clipping planes of 0.5 and 10</span>
<a name="l00076"></a>00076  <a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;setShape(45,(<span class="keywordtype">float</span>)720.0/576.0,0.5,150,ngl::PERSPECTIVE);
<a name="l00077"></a>00077  <span class="comment">// now to load the shader and set the values</span>
<a name="l00078"></a>00078  <span class="comment">// grab an instance of shader manager</span>
<a name="l00079"></a>00079  ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00080"></a>00080  <span class="comment">// we are creating a shader called Phong</span>
<a name="l00081"></a>00081  shader-&gt;createShaderProgram(<span class="stringliteral">&quot;Phong&quot;</span>);
<a name="l00082"></a>00082  <span class="comment">// now we are going to create empty shaders for Frag and Vert</span>
<a name="l00083"></a>00083  shader-&gt;attachShader(<span class="stringliteral">&quot;PhongVertex&quot;</span>,ngl::VERTEX);
<a name="l00084"></a>00084  shader-&gt;attachShader(<span class="stringliteral">&quot;PhongFragment&quot;</span>,ngl::FRAGMENT);
<a name="l00085"></a>00085  <span class="comment">// attach the source</span>
<a name="l00086"></a>00086  shader-&gt;loadShaderSource(<span class="stringliteral">&quot;PhongVertex&quot;</span>,<span class="stringliteral">&quot;shaders/Phong.vs&quot;</span>);
<a name="l00087"></a>00087  shader-&gt;loadShaderSource(<span class="stringliteral">&quot;PhongFragment&quot;</span>,<span class="stringliteral">&quot;shaders/Phong.fs&quot;</span>);
<a name="l00088"></a>00088  <span class="comment">// compile the shaders</span>
<a name="l00089"></a>00089  shader-&gt;compileShader(<span class="stringliteral">&quot;PhongVertex&quot;</span>);
<a name="l00090"></a>00090  shader-&gt;compileShader(<span class="stringliteral">&quot;PhongFragment&quot;</span>);
<a name="l00091"></a>00091  <span class="comment">// add them to the program</span>
<a name="l00092"></a>00092  shader-&gt;attachShaderToProgram(<span class="stringliteral">&quot;Phong&quot;</span>,<span class="stringliteral">&quot;PhongVertex&quot;</span>);
<a name="l00093"></a>00093  shader-&gt;attachShaderToProgram(<span class="stringliteral">&quot;Phong&quot;</span>,<span class="stringliteral">&quot;PhongFragment&quot;</span>);
<a name="l00094"></a>00094  <span class="comment">// now bind the shader attributes for most NGL primitives we use the following</span>
<a name="l00095"></a>00095  <span class="comment">// layout attribute 0 is the vertex data (x,y,z)</span>
<a name="l00096"></a>00096  shader-&gt;bindAttribute(<span class="stringliteral">&quot;Phong&quot;</span>,0,<span class="stringliteral">&quot;inVert&quot;</span>);
<a name="l00097"></a>00097  <span class="comment">// attribute 1 is the UV data u,v (if present)</span>
<a name="l00098"></a>00098  shader-&gt;bindAttribute(<span class="stringliteral">&quot;Phong&quot;</span>,1,<span class="stringliteral">&quot;inUV&quot;</span>);
<a name="l00099"></a>00099  <span class="comment">// attribute 2 are the normals x,y,z</span>
<a name="l00100"></a>00100  shader-&gt;bindAttribute(<span class="stringliteral">&quot;Phong&quot;</span>,2,<span class="stringliteral">&quot;inNormal&quot;</span>);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102  <span class="comment">// now we have associated this data we can link the shader</span>
<a name="l00103"></a>00103  shader-&gt;linkProgramObject(<span class="stringliteral">&quot;Phong&quot;</span>);
<a name="l00104"></a>00104  <span class="comment">// and make it active ready to load values</span>
<a name="l00105"></a>00105  (*shader)[<span class="stringliteral">&quot;Phong&quot;</span>]-&gt;use();
<a name="l00106"></a>00106  shader-&gt;setShaderParam1i(<span class="stringliteral">&quot;Normalize&quot;</span>,1);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108  <span class="comment">//------</span>
<a name="l00109"></a>00109  <span class="comment">// texture shader</span>
<a name="l00110"></a>00110  ngl::ShaderLib *shader1=ngl::ShaderLib::instance();
<a name="l00111"></a>00111  <span class="comment">// we are creating a shader called Texture</span>
<a name="l00112"></a>00112  shader1-&gt;createShaderProgram(<span class="stringliteral">&quot;Texture&quot;</span>);
<a name="l00113"></a>00113  <span class="comment">// now we are going to create empty shaders for Frag and Vert</span>
<a name="l00114"></a>00114  shader1-&gt;attachShader(<span class="stringliteral">&quot;TextureVertex&quot;</span>,ngl::VERTEX);
<a name="l00115"></a>00115  shader1-&gt;attachShader(<span class="stringliteral">&quot;TextureFragment&quot;</span>,ngl::FRAGMENT);
<a name="l00116"></a>00116  <span class="comment">// attach the source</span>
<a name="l00117"></a>00117  shader1-&gt;loadShaderSource(<span class="stringliteral">&quot;TextureVertex&quot;</span>,<span class="stringliteral">&quot;shaders/TextureVertex.glsl&quot;</span>);
<a name="l00118"></a>00118  shader1-&gt;loadShaderSource(<span class="stringliteral">&quot;TextureFragment&quot;</span>,<span class="stringliteral">&quot;shaders/TextureFragment.glsl&quot;</span>);
<a name="l00119"></a>00119  <span class="comment">// compile the shaders</span>
<a name="l00120"></a>00120  shader1-&gt;compileShader(<span class="stringliteral">&quot;TextureVertex&quot;</span>);
<a name="l00121"></a>00121  shader1-&gt;compileShader(<span class="stringliteral">&quot;TextureFragment&quot;</span>);
<a name="l00122"></a>00122  <span class="comment">// add them to the program</span>
<a name="l00123"></a>00123  shader1-&gt;attachShaderToProgram(<span class="stringliteral">&quot;Texture&quot;</span>,<span class="stringliteral">&quot;TextureVertex&quot;</span>);
<a name="l00124"></a>00124  shader1-&gt;attachShaderToProgram(<span class="stringliteral">&quot;Texture&quot;</span>,<span class="stringliteral">&quot;TextureFragment&quot;</span>);
<a name="l00125"></a>00125  <span class="comment">// now we have associated this data we can link the shader</span>
<a name="l00126"></a>00126  shader1-&gt;linkProgramObject(<span class="stringliteral">&quot;Texture&quot;</span>);
<a name="l00127"></a>00127  (*shader1)[<span class="stringliteral">&quot;Texture&quot;</span>]-&gt;use();
<a name="l00128"></a>00128  <span class="comment">//------</span>
<a name="l00129"></a>00129  <span class="comment">// now pass the modelView and projection values to the shader</span>
<a name="l00130"></a>00130  <span class="comment">// the shader will use the currently active material and light0 so set them</span>
<a name="l00131"></a>00131  ngl::Material m(ngl::SILVER);
<a name="l00132"></a>00132  m.loadToShader(<span class="stringliteral">&quot;material&quot;</span>);
<a name="l00133"></a>00133  ngl::Light light(ngl::Vec3(4,4,0),ngl::Colour(1,1,1,1),ngl::Colour(1,1,1,1),ngl::POINTLIGHT);
<a name="l00134"></a>00134  ngl::Light spot(ngl::Vec3(10,2,2),ngl::Colour(1,1,1,1),ngl::Colour(1,1,1,1),ngl::SPOTLIGHT);
<a name="l00135"></a>00135  <span class="comment">// now create our light this is done after the camera so we can pass the</span>
<a name="l00136"></a>00136  <span class="comment">// transpose of the projection matrix to the light to do correct eye space</span>
<a name="l00137"></a>00137  <span class="comment">// transformations</span>
<a name="l00138"></a>00138  ngl::Mat4 iv=<a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;getViewMatrix();
<a name="l00139"></a>00139  iv.transpose();
<a name="l00140"></a>00140  light.setTransform(iv);
<a name="l00141"></a>00141  light.setAttenuation(1,0,0);
<a name="l00142"></a>00142  light.enable();
<a name="l00143"></a>00143  <span class="comment">// load these values to the shader as well</span>
<a name="l00144"></a>00144  light.loadToShader(<span class="stringliteral">&quot;light&quot;</span>);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146  <span class="comment">//SPOTLIGHT</span>
<a name="l00147"></a>00147  spot.setTransform(iv);
<a name="l00148"></a>00148  spot.setAttenuation(1,0,0);
<a name="l00149"></a>00149  spot.enable();
<a name="l00150"></a>00150  <span class="comment">// load these values to the shader as well</span>
<a name="l00151"></a>00151  spot.loadToShader(<span class="stringliteral">&quot;light&quot;</span>);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153  shader-&gt;createShaderProgram(<span class="stringliteral">&quot;Colour&quot;</span>);
<a name="l00154"></a>00154  shader-&gt;attachShader(<span class="stringliteral">&quot;ColourVertex&quot;</span>,ngl::VERTEX);
<a name="l00155"></a>00155  shader-&gt;attachShader(<span class="stringliteral">&quot;ColourFragment&quot;</span>,ngl::FRAGMENT);
<a name="l00156"></a>00156  shader-&gt;loadShaderSource(<span class="stringliteral">&quot;ColourVertex&quot;</span>,<span class="stringliteral">&quot;shaders/Colour.vs&quot;</span>);
<a name="l00157"></a>00157  shader-&gt;loadShaderSource(<span class="stringliteral">&quot;ColourFragment&quot;</span>,<span class="stringliteral">&quot;shaders/Colour.fs&quot;</span>);
<a name="l00158"></a>00158  shader-&gt;compileShader(<span class="stringliteral">&quot;ColourVertex&quot;</span>);
<a name="l00159"></a>00159  shader-&gt;compileShader(<span class="stringliteral">&quot;ColourFragment&quot;</span>);
<a name="l00160"></a>00160  shader-&gt;attachShaderToProgram(<span class="stringliteral">&quot;Colour&quot;</span>,<span class="stringliteral">&quot;ColourVertex&quot;</span>);
<a name="l00161"></a>00161  shader-&gt;attachShaderToProgram(<span class="stringliteral">&quot;Colour&quot;</span>,<span class="stringliteral">&quot;ColourFragment&quot;</span>);
<a name="l00162"></a>00162  shader-&gt;bindAttribute(<span class="stringliteral">&quot;Colour&quot;</span>,0,<span class="stringliteral">&quot;inVert&quot;</span>);
<a name="l00163"></a>00163  shader-&gt;linkProgramObject(<span class="stringliteral">&quot;Colour&quot;</span>);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165  <span class="comment">//m_cloth = new Cloth(&quot;texture/table.png&quot;);</span>
<a name="l00166"></a>00166  <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a> = <span class="keyword">new</span> <a class="code" href="class_cloth.html" title="this class creates the cloth according to mass-spring model it updates the cloth...">Cloth</a>(<a class="code" href="class_g_l_window.html#a94d88d543a8bd1055ef3986429aece00">clothtex</a>);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168  <a class="code" href="class_g_l_window.html#a61a5235bb57caefb1ba69d78aab80cb7" title="meshes">m_prop</a>.<a class="code" href="class_props.html#a3f48cb7b77ea11a147fbe687e629be71" title="method to add a mesh with no texture">addProp</a>(<span class="stringliteral">&quot;psphere&quot;</span>,<span class="stringliteral">&quot;props/sphere_1.obj&quot;</span>,<span class="stringliteral">&quot;texture/silk.png&quot;</span>);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170  <a class="code" href="class_g_l_window.html#a61a5235bb57caefb1ba69d78aab80cb7" title="meshes">m_prop</a>.<a class="code" href="class_props.html#a3f48cb7b77ea11a147fbe687e629be71" title="method to add a mesh with no texture">addProp</a>(<span class="stringliteral">&quot;ptable&quot;</span>,<span class="stringliteral">&quot;props/table_1.obj&quot;</span>,<span class="stringliteral">&quot;texture/wood.jpg&quot;</span>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173  <span class="comment">//primitive instance for draw function of sphere</span>
<a name="l00174"></a>00174  ngl::VAOPrimitives *prim =  ngl::VAOPrimitives::instance();
<a name="l00175"></a>00175 
<a name="l00176"></a>00176    prim-&gt;createSphere(<span class="stringliteral">&quot;sphere&quot;</span>,1.0,40);
<a name="l00177"></a>00177    ngl::Vec3 n;
<a name="l00178"></a>00178    n.set(0,-1,0);
<a name="l00179"></a>00179    prim-&gt;createTrianglePlane(<span class="stringliteral">&quot;table&quot;</span>,1,1,1,1,n);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00183"></a><a class="code" href="class_g_l_window.html#a63bda97683454fb9e57af4487fc57e7e">00183</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a63bda97683454fb9e57af4487fc57e7e" title="method to set number of cloth particles it emits a signal once it has been creating...">GLWindow::setClothPartNum</a>(<span class="keywordtype">double</span> _n)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     <a class="code" href="class_g_l_window.html#a401a0d7eeee6f4b21c5e6e501842e36c" title="variable to recieve user input for number of cloth partiles">m_cp</a> = _n;
<a name="l00186"></a>00186     <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#ad1eb426f714658ab6fc01b3b76f65707">m_reset</a>==<span class="keyword">true</span>)
<a name="l00187"></a>00187     {
<a name="l00188"></a>00188         <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a78b4b9f5ef642c351a5242a8fab4a2fe" title="bool to keep cloth fixed for simulations">m_fix</a> = <span class="keyword">true</span>;
<a name="l00189"></a>00189         <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#abdd2de6586d933a083b6e3242c7f3f87" title="method to create the cloth grid and its spring connections">createCloth</a>(<a class="code" href="class_g_l_window.html#a401a0d7eeee6f4b21c5e6e501842e36c" title="variable to recieve user input for number of cloth partiles">m_cp</a>,<a class="code" href="class_g_l_window.html#a94d88d543a8bd1055ef3986429aece00">clothtex</a>);
<a name="l00190"></a>00190         <a class="code" href="class_g_l_window.html#ad1eb426f714658ab6fc01b3b76f65707">m_reset</a>=<span class="keyword">false</span>;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         emit <a class="code" href="class_g_l_window.html#a44b9cb8af77e13976f475774f3559692" title="signal emitted when the cloth has been created">clothcreated</a>();
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00196"></a>00196 <span class="comment">//This virtual function is called whenever the widget has been resized.</span>
<a name="l00197"></a>00197 <span class="comment">// The new size is passed in width and height.</span>
<a name="l00198"></a>00198 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00199"></a><a class="code" href="class_g_l_window.html#abe57c0f40e59cba4c98759121e22eb47">00199</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#abe57c0f40e59cba4c98759121e22eb47" title="this is called whenever the window is re-sized">GLWindow::resizeGL</a>(
<a name="l00200"></a>00200                         <span class="keywordtype">int</span> _w,
<a name="l00201"></a>00201                         <span class="keywordtype">int</span> _h
<a name="l00202"></a>00202                        )
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204   glViewport(0,0,_w,_h);
<a name="l00205"></a>00205   <a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;setShape(45,(<span class="keywordtype">float</span>)_w/_h,0.5,150,ngl::PERSPECTIVE);
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="class_g_l_window.html#ab78209ce50dd6820686aa05fc242eb7a">00208</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#ab78209ce50dd6820686aa05fc242eb7a" title="method to load the tx stack (+MVP) to the shader">GLWindow::loadMatricesToShader</a>(
<a name="l00209"></a>00209                                      ngl::TransformStack &amp;_tx
<a name="l00210"></a>00210                                    )
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212   ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00213"></a>00213   <span class="comment">//(*shader)[&quot;Phong&quot;]-&gt;use();</span>
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   ngl::Mat4 MV;
<a name="l00216"></a>00216   ngl::Mat4 MVP;
<a name="l00217"></a>00217   ngl::Mat3 normalMatrix;
<a name="l00218"></a>00218   ngl::Mat4 M;
<a name="l00219"></a>00219   M=_tx.getCurrentTransform().getMatrix();
<a name="l00220"></a>00220   MV=_tx.getCurrAndGlobal().getMatrix()*<a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;getViewMatrix() ;
<a name="l00221"></a>00221   MVP=MV*<a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;getProjectionMatrix();
<a name="l00222"></a>00222   normalMatrix=MV;
<a name="l00223"></a>00223   normalMatrix.inverse();
<a name="l00224"></a>00224   shader-&gt;setShaderParamFromMat4(<span class="stringliteral">&quot;MV&quot;</span>,MV);
<a name="l00225"></a>00225   shader-&gt;setShaderParamFromMat4(<span class="stringliteral">&quot;MVP&quot;</span>,MVP);
<a name="l00226"></a>00226   shader-&gt;setShaderParamFromMat3(<span class="stringliteral">&quot;normalMatrix&quot;</span>,normalMatrix);
<a name="l00227"></a>00227   shader-&gt;setShaderParamFromMat4(<span class="stringliteral">&quot;M&quot;</span>,M);
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00230"></a><a class="code" href="class_g_l_window.html#a508372a067e963cdf98d1ffd4efffbc5">00230</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a508372a067e963cdf98d1ffd4efffbc5" title="method load matrices to the colour shader">GLWindow::loadMatricesToColourShader</a>(
<a name="l00231"></a>00231                                            ngl::TransformStack &amp;_tx
<a name="l00232"></a>00232                                          )
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00235"></a>00235   (*shader)[<span class="stringliteral">&quot;Colour&quot;</span>]-&gt;use();
<a name="l00236"></a>00236   ngl::Mat4 MV;
<a name="l00237"></a>00237   ngl::Mat4 MVP;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   MV=_tx.getCurrAndGlobal().getMatrix()*<a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;getViewMatrix() ;
<a name="l00240"></a>00240   MVP=MV*<a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>-&gt;getProjectionMatrix() ;
<a name="l00241"></a>00241   shader-&gt;setShaderParamFromMat4(<span class="stringliteral">&quot;MVP&quot;</span>,MVP);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00245"></a>00245 <span class="comment">//This virtual function is called whenever the widget needs to be painted.</span>
<a name="l00246"></a>00246 <span class="comment">// this is our main drawing routine</span>
<a name="l00247"></a>00247 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00248"></a><a class="code" href="class_g_l_window.html#a9bd2503dd5f812c10a9481f22ecd3403">00248</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a9bd2503dd5f812c10a9481f22ecd3403" title="this is the main gl drawing routine which is called whenever the window needs to...">GLWindow::paintGL</a>()
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="comment">// grab an instance of the shader manager</span>
<a name="l00252"></a>00252   ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00253"></a>00253   <span class="comment">// clear the screen and depth buffer</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
<a name="l00256"></a>00256   <span class="comment">// Rotation based on the mouse position for our global</span>
<a name="l00257"></a>00257   <span class="comment">// transform</span>
<a name="l00258"></a>00258   ngl::Transformation trans;
<a name="l00259"></a>00259   trans.setRotation(<a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>,<a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>,0);
<a name="l00260"></a>00260   <span class="comment">// Rotation based on the mouse position for our global</span>
<a name="l00261"></a>00261   <span class="comment">// transform</span>
<a name="l00262"></a>00262   ngl::Mat4 rotX;
<a name="l00263"></a>00263   ngl::Mat4 rotY;
<a name="l00264"></a>00264   <span class="comment">// create the rotation matrices</span>
<a name="l00265"></a>00265   rotX.rotateX(<a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a>);
<a name="l00266"></a>00266   rotY.rotateY(<a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a>);
<a name="l00267"></a>00267   <span class="comment">// multiply the rotations</span>
<a name="l00268"></a>00268   ngl::Mat4 <span class="keyword">final</span>=rotY*rotX;
<a name="l00269"></a>00269   <span class="comment">// add the translations</span>
<a name="l00270"></a>00270   <span class="keyword">final</span>.m_m[3][0] = <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_x;
<a name="l00271"></a>00271   <span class="keyword">final</span>.m_m[3][1] = <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_y;
<a name="l00272"></a>00272   <span class="keyword">final</span>.m_m[3][2] = <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_z;
<a name="l00273"></a>00273   <span class="comment">// set this in the TX stack</span>
<a name="l00274"></a>00274   trans.setMatrix(<span class="keyword">final</span>);
<a name="l00275"></a>00275   <span class="comment">// set this in the TX stack</span>
<a name="l00276"></a>00276   <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.setGlobal(trans);
<a name="l00277"></a>00277   <span class="comment">// draw spring lines</span>
<a name="l00278"></a>00278   shader-&gt;use(<span class="stringliteral">&quot;Phong&quot;</span>);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 <span class="keywordflow">if</span> (<a class="code" href="class_g_l_window.html#a7687d94368fa3512f2ee0fc747a149b7">m_draw</a> == <span class="keyword">true</span> || <a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a>==<span class="keyword">true</span>)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283     <span class="comment">//cloth</span>
<a name="l00284"></a>00284     <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.pushTransform();
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286         ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00287"></a>00287         (*shader)[<span class="stringliteral">&quot;Texture&quot;</span>]-&gt;use();
<a name="l00288"></a>00288         <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.setPosition(-5.0,0.0,0.0);
<a name="l00289"></a>00289         <a class="code" href="class_g_l_window.html#ab78209ce50dd6820686aa05fc242eb7a" title="method to load the tx stack (+MVP) to the shader">loadMatricesToShader</a>(<a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>);
<a name="l00290"></a>00290         <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a0d9edc32dee9ceaead679f3b904262d2" title="Draw method for drawing the cloth.">drawTriCloth</a>(<span class="stringliteral">&quot;Texture&quot;</span>,<a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>,<a class="code" href="class_g_l_window.html#a55556dafb4fc86c35b270ca0d68f456e" title="Our Camera.">m_cam</a>);
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292     <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.popTransform();
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">//table</span>
<a name="l00295"></a>00295     <span class="keywordflow">if</span>( <a class="code" href="class_g_l_window.html#af6244a13882c36f6c20c90e96f0edfdc">m_tableCollision</a> == <span class="keyword">true</span>)
<a name="l00296"></a>00296     {
<a name="l00297"></a>00297         <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a78b4b9f5ef642c351a5242a8fab4a2fe" title="bool to keep cloth fixed for simulations">m_fix</a> =<span class="keyword">false</span>;
<a name="l00298"></a>00298         <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.pushTransform();
<a name="l00299"></a>00299         {
<a name="l00300"></a>00300             ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00301"></a>00301              (*shader)[<span class="stringliteral">&quot;Texture&quot;</span>]-&gt;use();
<a name="l00302"></a>00302             <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.setPosition(0.0,-5.5,5.0);
<a name="l00303"></a>00303             <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.setScale(5.2,6.0,5.2);
<a name="l00304"></a>00304             glEnable (GL_BLEND);
<a name="l00305"></a>00305             glBindTexture(GL_TEXTURE_2D,<a class="code" href="class_g_l_window.html#ad43fd02569cd573f09134bc7bc0263ec" title="texture id for table and sphere;">m_texIDTable</a>);
<a name="l00306"></a>00306             <a class="code" href="class_g_l_window.html#ab78209ce50dd6820686aa05fc242eb7a" title="method to load the tx stack (+MVP) to the shader">loadMatricesToShader</a>(<a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>);
<a name="l00307"></a>00307             <a class="code" href="class_g_l_window.html#a61a5235bb57caefb1ba69d78aab80cb7" title="meshes">m_prop</a>.<a class="code" href="class_props.html#a7addd1444147b3de20fd076071a84a2e" title="method to draw the mesh, all tx must be executed before the call to draw">draw</a>(<span class="stringliteral">&quot;ptable&quot;</span>);
<a name="l00308"></a>00308              glDisable(GL_BLEND);
<a name="l00309"></a>00309          }
<a name="l00310"></a>00310        <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.popTransform();
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">//sphere</span>
<a name="l00314"></a>00314     <span class="keywordflow">if</span>( <a class="code" href="class_g_l_window.html#a73f75e2715ec333f4ab05281e5862f37">m_sphereCollision</a> == <span class="keyword">true</span>)
<a name="l00315"></a>00315     {
<a name="l00316"></a>00316         <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a78b4b9f5ef642c351a5242a8fab4a2fe" title="bool to keep cloth fixed for simulations">m_fix</a> =<span class="keyword">true</span>;
<a name="l00317"></a>00317         <span class="keywordtype">float</span> rad = 1.5;
<a name="l00318"></a>00318         <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.pushTransform();
<a name="l00319"></a>00319         {
<a name="l00320"></a>00320             ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00321"></a>00321              (*shader)[<span class="stringliteral">&quot;Texture&quot;</span>]-&gt;use();
<a name="l00322"></a>00322             <span class="comment">//m_transformStack.setPosition(2,-4,1);</span>
<a name="l00323"></a>00323             <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.setPosition(-3,-4,1);
<a name="l00324"></a>00324             <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.setScale(rad,rad,rad);
<a name="l00325"></a>00325             <a class="code" href="class_g_l_window.html#ab78209ce50dd6820686aa05fc242eb7a" title="method to load the tx stack (+MVP) to the shader">loadMatricesToShader</a>(<a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>);
<a name="l00326"></a>00326             <a class="code" href="class_g_l_window.html#a61a5235bb57caefb1ba69d78aab80cb7" title="meshes">m_prop</a>.<a class="code" href="class_props.html#a7addd1444147b3de20fd076071a84a2e" title="method to draw the mesh, all tx must be executed before the call to draw">draw</a>(<span class="stringliteral">&quot;psphere&quot;</span>);
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328         <a class="code" href="class_g_l_window.html#aaa941adbe7772d03588f312326100e5f" title="transformation stack for the gl transformations etc">m_transformStack</a>.popTransform();
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00334"></a><a class="code" href="class_g_l_window.html#a7a04e2a3400fa69d1bcb6b650425c01e">00334</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a7a04e2a3400fa69d1bcb6b650425c01e" title="this method is called every time a mouse is moved">GLWindow::mouseMoveEvent</a> (
<a name="l00335"></a>00335                                QMouseEvent * _event
<a name="l00336"></a>00336                               )
<a name="l00337"></a>00337 {
<a name="l00338"></a>00338   <span class="comment">// note the method buttons() is the button state when event was called</span>
<a name="l00339"></a>00339   <span class="comment">// this is different from button() which is used to check which button was</span>
<a name="l00340"></a>00340   <span class="comment">// pressed when the mousePress/Release event is generated</span>
<a name="l00341"></a>00341     <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a> &amp;&amp; _event-&gt;buttons() == Qt::LeftButton)
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343       <span class="keywordtype">int</span> diffx=_event-&gt;x()-<a class="code" href="class_g_l_window.html#ab6aec410f5ce5868cabe5fe2f0768bc9" title="the previous x mouse value">m_origX</a>;
<a name="l00344"></a>00344       <span class="keywordtype">int</span> diffy=_event-&gt;y()-<a class="code" href="class_g_l_window.html#ab7a1ee2202588e005b90c99ea1323af4" title="the previous y mouse value">m_origY</a>;
<a name="l00345"></a>00345       <a class="code" href="class_g_l_window.html#af8ea09020a5ad4c20a16ea835ed1f2af" title="used to store the x rotation mouse value">m_spinXFace</a> += (float) 0.5f * diffy;
<a name="l00346"></a>00346       <a class="code" href="class_g_l_window.html#aa4c39badfa80d8eac6a773449b6db5a2" title="used to store the y rotation mouse value">m_spinYFace</a> += (float) 0.5f * diffx;
<a name="l00347"></a>00347       <a class="code" href="class_g_l_window.html#ab6aec410f5ce5868cabe5fe2f0768bc9" title="the previous x mouse value">m_origX</a> = _event-&gt;x();
<a name="l00348"></a>00348       <a class="code" href="class_g_l_window.html#ab7a1ee2202588e005b90c99ea1323af4" title="the previous y mouse value">m_origY</a> = _event-&gt;y();
<a name="l00349"></a>00349       updateGL();
<a name="l00350"></a>00350 
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     <span class="comment">// right mouse translate code</span>
<a name="l00353"></a>00353     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#a3a7f7ae3fbde7c5e24ff677a6ed34563" title="flag to indicate if the Right mouse button is pressed when dragging">m_translate</a> &amp;&amp; _event-&gt;buttons() == Qt::RightButton)
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355       <span class="keywordtype">int</span> diffX = (int)(_event-&gt;x() - <a class="code" href="class_g_l_window.html#a176afd6632502975d692b69a90488670" title="the previous x mouse value for Position changes">m_origXPos</a>);
<a name="l00356"></a>00356       <span class="keywordtype">int</span> diffY = (int)(_event-&gt;y() - <a class="code" href="class_g_l_window.html#aab805b77275ea41e8ff2dcf9e714f345" title="the previous y mouse value for Position changes">m_origYPos</a>);
<a name="l00357"></a>00357       <a class="code" href="class_g_l_window.html#a176afd6632502975d692b69a90488670" title="the previous x mouse value for Position changes">m_origXPos</a>=_event-&gt;x();
<a name="l00358"></a>00358       <a class="code" href="class_g_l_window.html#aab805b77275ea41e8ff2dcf9e714f345" title="the previous y mouse value for Position changes">m_origYPos</a>=_event-&gt;y();
<a name="l00359"></a>00359       <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_x += <a class="code" href="_g_l_window_8h.html#a1e7bfa770ab6ff97ddeda9d97a5bd527" title="the increment for x/y translation with mouse movement">INCREMENT</a> * diffX;
<a name="l00360"></a>00360       <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_y -= <a class="code" href="_g_l_window_8h.html#a1e7bfa770ab6ff97ddeda9d97a5bd527" title="the increment for x/y translation with mouse movement">INCREMENT</a> * diffY;
<a name="l00361"></a>00361       updateGL();
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 }
<a name="l00364"></a>00364 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00365"></a><a class="code" href="class_g_l_window.html#a2c4d9af80c2a7a33a46bce46276b8409">00365</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a2c4d9af80c2a7a33a46bce46276b8409" title="this method is called everytime the mouse button is pressed inherited from QObject...">GLWindow::mousePressEvent</a> (
<a name="l00366"></a>00366                                 QMouseEvent * _event
<a name="l00367"></a>00367                                )
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369   <span class="comment">// this method is called when the mouse button is pressed in this case we</span>
<a name="l00370"></a>00370   <span class="comment">// store the value where the maouse was clicked (x,y) and set the Rotate flag to true</span>
<a name="l00371"></a>00371     <span class="keywordflow">if</span>(_event-&gt;button() == Qt::LeftButton)
<a name="l00372"></a>00372     {
<a name="l00373"></a>00373       <a class="code" href="class_g_l_window.html#ab6aec410f5ce5868cabe5fe2f0768bc9" title="the previous x mouse value">m_origX</a> = _event-&gt;x();
<a name="l00374"></a>00374       <a class="code" href="class_g_l_window.html#ab7a1ee2202588e005b90c99ea1323af4" title="the previous y mouse value">m_origY</a> = _event-&gt;y();
<a name="l00375"></a>00375       <a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a> =<span class="keyword">true</span>;
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377     <span class="comment">// right mouse translate mode</span>
<a name="l00378"></a>00378     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(_event-&gt;button() == Qt::RightButton)
<a name="l00379"></a>00379     {
<a name="l00380"></a>00380       <a class="code" href="class_g_l_window.html#a176afd6632502975d692b69a90488670" title="the previous x mouse value for Position changes">m_origXPos</a> = _event-&gt;x();
<a name="l00381"></a>00381       <a class="code" href="class_g_l_window.html#aab805b77275ea41e8ff2dcf9e714f345" title="the previous y mouse value for Position changes">m_origYPos</a> = _event-&gt;y();
<a name="l00382"></a>00382       <a class="code" href="class_g_l_window.html#a3a7f7ae3fbde7c5e24ff677a6ed34563" title="flag to indicate if the Right mouse button is pressed when dragging">m_translate</a>=<span class="keyword">true</span>;
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00387"></a><a class="code" href="class_g_l_window.html#ab9e5741b8c69d2f6447a5fc6d9d704c8">00387</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#ab9e5741b8c69d2f6447a5fc6d9d704c8" title="this method is called everytime the mouse button is released inherited from QObject...">GLWindow::mouseReleaseEvent</a> (
<a name="l00388"></a>00388                                   QMouseEvent * _event
<a name="l00389"></a>00389                                  )
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391   <span class="comment">// this event is called when the mouse button is released</span>
<a name="l00392"></a>00392   <span class="comment">// we then set Rotate to false</span>
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (_event-&gt;button() == Qt::LeftButton)
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395       <a class="code" href="class_g_l_window.html#a1b5d8b223995bc9740074c5342fe8e38" title="flag to indicate if the mouse button is pressed when dragging">m_rotate</a>=<span class="keyword">false</span>;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397     <span class="comment">// right mouse translate mode</span>
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (_event-&gt;button() == Qt::RightButton)
<a name="l00399"></a>00399     {
<a name="l00400"></a>00400       <a class="code" href="class_g_l_window.html#a3a7f7ae3fbde7c5e24ff677a6ed34563" title="flag to indicate if the Right mouse button is pressed when dragging">m_translate</a>=<span class="keyword">false</span>;
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00406"></a><a class="code" href="class_g_l_window.html#a5f96a70cc4c2666b46ecfa62de7be598">00406</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a5f96a70cc4c2666b46ecfa62de7be598" title="this method is called everytime the mouse wheel is moved inherited from QObject and...">GLWindow::wheelEvent</a>(QWheelEvent *_event)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="comment">// check the diff of the wheel position (0 means no change)</span>
<a name="l00410"></a>00410   <span class="keywordflow">if</span>(_event-&gt;delta() &gt; 0)
<a name="l00411"></a>00411   {
<a name="l00412"></a>00412     <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_z+=<a class="code" href="_g_l_window_8h.html#ad53f4ea4bad2000e469a9b538c39878f" title="the increment for the wheel zoom">ZOOM</a>;
<a name="l00413"></a>00413   }
<a name="l00414"></a>00414   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(_event-&gt;delta() &lt;0 )
<a name="l00415"></a>00415   {
<a name="l00416"></a>00416     <a class="code" href="class_g_l_window.html#a222840baf9b594f95626a55563904684" title="the model position for mouse movement">m_modelPos</a>.m_z-=<a class="code" href="_g_l_window_8h.html#ad53f4ea4bad2000e469a9b538c39878f" title="the increment for the wheel zoom">ZOOM</a>;
<a name="l00417"></a>00417   }
<a name="l00418"></a>00418   updateGL();
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00421"></a><a class="code" href="class_g_l_window.html#a8901509418ab117e8613d624df9b5666">00421</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a8901509418ab117e8613d624df9b5666" title="timer event trigered by startTimer">GLWindow::timerEvent</a>(
<a name="l00422"></a>00422                         QTimerEvent *_event
<a name="l00423"></a>00423                         )
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a> == <span class="keyword">true</span> || <a class="code" href="class_g_l_window.html#a7687d94368fa3512f2ee0fc747a149b7">m_draw</a> == <span class="keyword">true</span>)
<a name="l00427"></a>00427     {
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="comment">//m_cloth-&gt;updateCloth();</span>
<a name="l00430"></a>00430         <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#ad26926a8404ce36de4a540c38903a6b3" title="method to update the cloth- forces(internal and external) and update the mass particles...">updateCloth</a>();
<a name="l00431"></a>00431 
<a name="l00432"></a>00432         <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#a73f75e2715ec333f4ab05281e5862f37">m_sphereCollision</a>==<span class="keyword">true</span>)
<a name="l00433"></a>00433         {   <a class="code" href="class_g_l_window.html#a13176d9a993618b05a0b47aa076696c0" title="method for cloth&amp;#39;s collision with sphere">clothSphereCollision</a>(); <a class="code" href="class_g_l_window.html#ad1eb426f714658ab6fc01b3b76f65707">m_reset</a>=<span class="keyword">true</span>;
<a name="l00434"></a>00434             <a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a> = <span class="keyword">false</span>;
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437         <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#af6244a13882c36f6c20c90e96f0edfdc">m_tableCollision</a>==<span class="keyword">true</span>)
<a name="l00438"></a>00438             {
<a name="l00439"></a>00439                 emit <a class="code" href="class_g_l_window.html#a9ed9f0d600a48b75d1dc1786e73d0d26" title="signal to reset the cloth to its initila state">resetCloth</a>();
<a name="l00440"></a>00440                 <a class="code" href="class_g_l_window.html#ad1eb426f714658ab6fc01b3b76f65707">m_reset</a>=<span class="keyword">true</span>;
<a name="l00441"></a>00441                 <span class="keywordflow">for</span>(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;<a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.size();++i)
<a name="l00442"></a>00442                 {
<a name="l00443"></a>00443                     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;setNotFixed();
<a name="l00444"></a>00444                     <a class="code" href="class_g_l_window.html#a07353f58849d1ad5a675f738e66ca2e4" title="method to apply wind on cloth">dropOnTable</a>();
<a name="l00445"></a>00445                 }
<a name="l00446"></a>00446                 <a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a>=<span class="keyword">false</span>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448             }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <span class="keywordflow">if</span>(<a class="code" href="class_g_l_window.html#aff31c6c9c847c694f3d76112b5450f78">m_applyWind</a>==<span class="keyword">true</span> &amp;&amp; <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a78b4b9f5ef642c351a5242a8fab4a2fe" title="bool to keep cloth fixed for simulations">m_fix</a> == <span class="keyword">true</span>)
<a name="l00451"></a>00451         {
<a name="l00452"></a>00452             emit <a class="code" href="class_g_l_window.html#a9ed9f0d600a48b75d1dc1786e73d0d26" title="signal to reset the cloth to its initila state">resetCloth</a>();
<a name="l00453"></a>00453            <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a98c53cc7b566cb175e25185e1355c503">applyWindForce</a>();
<a name="l00454"></a>00454            <a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a>=<span class="keyword">false</span>;
<a name="l00455"></a>00455            updateGL();
<a name="l00456"></a>00456         }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458         updateGL();
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00463"></a><a class="code" href="class_g_l_window.html#aff50e08e7eadb0f5a124d86873b98674">00463</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#aff50e08e7eadb0f5a124d86873b98674" title="start the simulation timer">GLWindow::startSimTimer</a>()
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <a class="code" href="class_g_l_window.html#a3d00faa9bff1898af834152b40bcb926" title="the timer">m_timer</a>=startTimer(<a class="code" href="class_g_l_window.html#a2e3710bf09e4710291b3044e6744d897" title="the timer value in ms">m_timerValue</a>);
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00469"></a><a class="code" href="class_g_l_window.html#a13176d9a993618b05a0b47aa076696c0">00469</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a13176d9a993618b05a0b47aa076696c0" title="method for cloth&amp;#39;s collision with sphere">GLWindow::clothSphereCollision</a>()
<a name="l00470"></a>00470 {
<a name="l00471"></a>00471     <span class="keywordflow">for</span>(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;<a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.size();++i)
<a name="l00472"></a>00472        {
<a name="l00473"></a>00473 
<a name="l00474"></a>00474            <span class="comment">//check for collisions</span>
<a name="l00475"></a>00475             ngl::Vec3 relPos;
<a name="l00476"></a>00476             GLfloat len,dist,minDist;
<a name="l00477"></a>00477             <span class="comment">//sphere rad and pos</span>
<a name="l00478"></a>00478             ngl::Vec3 sPos;
<a name="l00479"></a>00479             sPos.set(2,-4,1);
<a name="l00480"></a>00480             minDist =1.65; <span class="comment">//</span>
<a name="l00481"></a>00481             <span class="comment">//cloth particle position</span>
<a name="l00482"></a>00482             ngl::Vec3 cpPos = <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;getPosition();
<a name="l00483"></a>00483             <span class="comment">//cloth particle velocity</span>
<a name="l00484"></a>00484             ngl::Vec3 cpVel = <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;getVelocity();
<a name="l00485"></a>00485 
<a name="l00486"></a>00486             relPos = (cpPos - sPos);
<a name="l00487"></a>00487             <span class="comment">//distance</span>
<a name="l00488"></a>00488             len = relPos.length();
<a name="l00489"></a>00489             <span class="keywordflow">if</span>(len&lt;=minDist)
<a name="l00490"></a>00490             {
<a name="l00491"></a>00491                 <span class="comment">//collision response</span>
<a name="l00492"></a>00492                 relPos.normalize();
<a name="l00493"></a>00493                 ngl::Vec3 pos = <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;getPosition();
<a name="l00494"></a>00494                 pos += (relPos*(minDist - len));
<a name="l00495"></a>00495                 <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;setPosition(pos);
<a name="l00496"></a>00496                 ngl::Vec3 vel = -cpVel.dot(relPos)*relPos+(cpVel-cpVel.dot(relPos)*relPos);
<a name="l00497"></a>00497                 <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;setVelocity(vel);
<a name="l00498"></a>00498             }
<a name="l00499"></a>00499          }
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00502"></a><a class="code" href="class_g_l_window.html#a07353f58849d1ad5a675f738e66ca2e4">00502</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a07353f58849d1ad5a675f738e66ca2e4" title="method to apply wind on cloth">GLWindow::dropOnTable</a>()
<a name="l00503"></a>00503 {
<a name="l00504"></a>00504     <a class="code" href="class_g_l_window.html#ab8f84328480ea8aad5bdf6956480ac15" title="table&amp;#39;s width and depth">twidth</a>=6.0f;<a class="code" href="class_g_l_window.html#a3d4538f9ab911dd55a5a20e21b2c0863">tdepth</a>=6.0f;
<a name="l00505"></a>00505     GLfloat d;
<a name="l00506"></a>00506     ngl::Vec3 particlePos;
<a name="l00507"></a>00507     <span class="keywordtype">float</span> ext[4];
<a name="l00508"></a>00508     ext[0]=ext[1]=<a class="code" href="class_g_l_window.html#ab8f84328480ea8aad5bdf6956480ac15" title="table&amp;#39;s width and depth">twidth</a>/2.0f;
<a name="l00509"></a>00509     ext[2]=ext[3]=<a class="code" href="class_g_l_window.html#a3d4538f9ab911dd55a5a20e21b2c0863">tdepth</a>/2.0f;
<a name="l00510"></a>00510     <a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.set(5,-5,5);
<a name="l00511"></a>00511     <a class="code" href="class_g_l_window.html#a950bae212c2546a0429ab39de5c4870a">t1</a>.set(<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_x-ext[0],<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_y,<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_z-ext[2]);
<a name="l00512"></a>00512     <a class="code" href="class_g_l_window.html#a19f7ebd04913db883b2265f5b3d3eab9">t2</a>.set(<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_x+ext[0],<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_y,<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_z-ext[2]);
<a name="l00513"></a>00513     <a class="code" href="class_g_l_window.html#abf9e2e515e16dbc25f4d8d4721db2d82">t3</a>.set(<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_x-ext[0],<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_y,<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_z+ext[2]);
<a name="l00514"></a>00514     <a class="code" href="class_g_l_window.html#ae562ad9f799e85984c43c7aef131be3b">t4</a>.set(<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_x+ext[0],<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_y,<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_z+ext[2]);
<a name="l00515"></a>00515     <a class="code" href="class_g_l_window.html#a6d35843bbedc45038a886e191fa2cf31">tnormal</a>=calcNormal(<a class="code" href="class_g_l_window.html#ae562ad9f799e85984c43c7aef131be3b">t4</a>,<a class="code" href="class_g_l_window.html#abf9e2e515e16dbc25f4d8d4721db2d82">t3</a>,<a class="code" href="class_g_l_window.html#a19f7ebd04913db883b2265f5b3d3eab9">t2</a>);
<a name="l00516"></a>00516     <span class="keywordflow">for</span>(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;<a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.size();++i)
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         particlePos = <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;getPosition();
<a name="l00519"></a>00519         d = <a class="code" href="class_g_l_window.html#a6d35843bbedc45038a886e191fa2cf31">tnormal</a>.dot(particlePos);
<a name="l00520"></a>00520         <span class="keywordflow">if</span>(d&lt;=<a class="code" href="class_g_l_window.html#a60cfe6b3ce80d3747cd4b8e2a15f91e3" title="table&amp;#39;s coordinate: tcenter - table center; t1,t2,t3,t4 - vertices; tnormal -...">tcenter</a>.m_y)
<a name="l00521"></a>00521         {
<a name="l00522"></a>00522             <span class="keywordflow">if</span>((particlePos.m_x&gt;=<a class="code" href="class_g_l_window.html#a950bae212c2546a0429ab39de5c4870a">t1</a>.m_x &amp;&amp; particlePos.m_x&lt;=<a class="code" href="class_g_l_window.html#a19f7ebd04913db883b2265f5b3d3eab9">t2</a>.m_x &amp;&amp;
<a name="l00523"></a>00523                 particlePos.m_z&gt;=<a class="code" href="class_g_l_window.html#a950bae212c2546a0429ab39de5c4870a">t1</a>.m_z &amp;&amp; particlePos.m_z&lt;=<a class="code" href="class_g_l_window.html#ae562ad9f799e85984c43c7aef131be3b">t4</a>.m_z) &amp;&amp;
<a name="l00524"></a>00524                 (particlePos.m_y&lt;=-5) &amp;&amp;(particlePos.m_y&gt;=-5.1)  )
<a name="l00525"></a>00525                 {
<a name="l00526"></a>00526                     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;setFixed();
<a name="l00527"></a>00527                 }
<a name="l00528"></a>00528          }
<a name="l00529"></a>00529      }
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00532"></a><a class="code" href="class_g_l_window.html#acaaadd067331e969703dbd0f5b2011a8">00532</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#acaaadd067331e969703dbd0f5b2011a8" title="to start simulation">GLWindow::setSim</a>()
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534     <a class="code" href="class_g_l_window.html#ac1c822888d05fc35f8c3b3f8f64b1179">m_sim</a> = <span class="keyword">true</span>;
<a name="l00535"></a>00535     <a class="code" href="class_g_l_window.html#a63bda97683454fb9e57af4487fc57e7e" title="method to set number of cloth particles it emits a signal once it has been creating...">setClothPartNum</a>(<a class="code" href="class_g_l_window.html#a401a0d7eeee6f4b21c5e6e501842e36c" title="variable to recieve user input for number of cloth partiles">m_cp</a>);
<a name="l00536"></a>00536     updateGL();
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00539"></a><a class="code" href="class_g_l_window.html#ae5c31ffbff3e9509ed95ed8d6a3df2cc">00539</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#ae5c31ffbff3e9509ed95ed8d6a3df2cc" title="method for cloth&amp;#39;s collision with sphere">GLWindow::setSphereCollision</a>(<span class="keywordtype">bool</span> _mode)
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541     emit <a class="code" href="class_g_l_window.html#a9ed9f0d600a48b75d1dc1786e73d0d26" title="signal to reset the cloth to its initila state">resetCloth</a>();
<a name="l00542"></a>00542     <a class="code" href="class_g_l_window.html#a73f75e2715ec333f4ab05281e5862f37">m_sphereCollision</a> = _mode;
<a name="l00543"></a>00543 }
<a name="l00544"></a>00544 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00545"></a><a class="code" href="class_g_l_window.html#abe54266e14e90e631cc07b7f0845454c">00545</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#abe54266e14e90e631cc07b7f0845454c" title="method for cloth&amp;#39;s collision with table">GLWindow::setTableCollision</a>(<span class="keywordtype">bool</span> _mode)
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547     <a class="code" href="class_g_l_window.html#ad1eb426f714658ab6fc01b3b76f65707">m_reset</a>=<span class="keyword">true</span>;
<a name="l00548"></a>00548     emit <a class="code" href="class_g_l_window.html#a9ed9f0d600a48b75d1dc1786e73d0d26" title="signal to reset the cloth to its initila state">resetCloth</a>();
<a name="l00549"></a>00549     <a class="code" href="class_g_l_window.html#af6244a13882c36f6c20c90e96f0edfdc">m_tableCollision</a> = _mode;
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00552"></a><a class="code" href="class_g_l_window.html#a6bd424ce6523dce6bc51f67fe3e5263c">00552</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a6bd424ce6523dce6bc51f67fe3e5263c" title="method to set the bool for applying wind on cloth">GLWindow::setApplyWind</a>(<span class="keywordtype">bool</span> _mode)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a78b4b9f5ef642c351a5242a8fab4a2fe" title="bool to keep cloth fixed for simulations">m_fix</a> = <span class="keyword">true</span>;
<a name="l00555"></a>00555     emit <a class="code" href="class_g_l_window.html#a9ed9f0d600a48b75d1dc1786e73d0d26" title="signal to reset the cloth to its initila state">resetCloth</a>();
<a name="l00556"></a>00556     <a class="code" href="class_g_l_window.html#aff31c6c9c847c694f3d76112b5450f78">m_applyWind</a> = _mode;
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00559"></a><a class="code" href="class_g_l_window.html#adb8b0fea40be2c7ea102a253947f219f">00559</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#adb8b0fea40be2c7ea102a253947f219f" title="method to set the draw flag for drawing the cloth">GLWindow::setDrawFlag</a>()
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561     <a class="code" href="class_g_l_window.html#a7687d94368fa3512f2ee0fc747a149b7">m_draw</a> = <span class="keyword">true</span>;
<a name="l00562"></a>00562     updateGL();
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00565"></a><a class="code" href="class_g_l_window.html#a89a200c20f190d6fd5fb78d87d2ca7e2">00565</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a89a200c20f190d6fd5fb78d87d2ca7e2" title="method to set cloth width">GLWindow::setClothWidth</a>(<span class="keywordtype">double</span> _w)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a77d2938ecfb108321be9d5252a147117" title="cloth width">mWidth</a> = _w;
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00570"></a><a class="code" href="class_g_l_window.html#a4773967cff62ae694cdf786a7efdbc5c">00570</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a4773967cff62ae694cdf786a7efdbc5c" title="method to set cloth depth">GLWindow::setClothDepth</a>(<span class="keywordtype">double</span> _h)
<a name="l00571"></a>00571 {
<a name="l00572"></a>00572     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a708b4b915911e7c74bc65ae0b0b734f2" title="cloth height">mHeight</a> = _h;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00575"></a><a class="code" href="class_g_l_window.html#ad97f2dfd180a85d9de797ad61e8ead2e">00575</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#ad97f2dfd180a85d9de797ad61e8ead2e" title="method to apply octree">GLWindow::applyOctree</a>(<span class="keywordtype">bool</span> _mode)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#ae060f23b57c590b6afc0f571a44d767e" title="bool to give user the choie of applying octree">m_applyOctree</a> = _mode;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00580"></a><a class="code" href="class_g_l_window.html#acb82b4f13c04fd0b4d8082f5a1329d9e">00580</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#acb82b4f13c04fd0b4d8082f5a1329d9e" title="method to add wind magnitude">GLWindow::addWindMag</a>(<span class="keywordtype">double</span> _mag)
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582     <a class="code" href="class_g_l_window.html#a81e771198e76b6368d9f35b4a250d214" title="pointer to Cloth">m_cloth</a>-&gt;<a class="code" href="class_cloth.html#a214dcb56aa2328e4f2d21ab35d76fbaf" title="wind magnitude that can be added via user interface">m_windMag</a> = _mag/1000;
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00585"></a><a class="code" href="class_g_l_window.html#a79d0e2dc7ca155fd2745b5f0a518407a">00585</a> <span class="keywordtype">void</span> <a class="code" href="class_g_l_window.html#a79d0e2dc7ca155fd2745b5f0a518407a" title="method to texture file from UI">GLWindow::setTexFileName</a>(std::string _filename)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <a class="code" href="class_g_l_window.html#a94d88d543a8bd1055ef3986429aece00">clothtex</a> = _filename;
<a name="l00588"></a>00588     updateGL();
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 10 May 2013 for ClothSimulation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
