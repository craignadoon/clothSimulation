<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ClothSimulation: Cloth.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>Cloth.cpp</h1><a href="_cloth_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="_cloth_8h.html" title="this class creates the cloth based on the mass-spring model">Cloth.h</a>&quot;</span>
<a name="l00002"></a>00002 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00005"></a>00005 <span class="comment"></span><span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00006"></a><a class="code" href="class_cloth.html#a74849e3c74939d015df740d2586cc0e9">00006</a> <a class="code" href="class_cloth.html#a74849e3c74939d015df740d2586cc0e9" title="Constructor.">Cloth::Cloth</a>(){
<a name="l00007"></a>00007     <a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a> = 10.0f; <span class="comment">//10 20    60</span>
<a name="l00008"></a>00008     <a class="code" href="class_cloth.html#ab45593ee4b2687538d946c73ddfea492" title="number of vertical mass particles">m_vertParticles</a> = 10.0f; <span class="comment">//10 20    60</span>
<a name="l00009"></a>00009     <a class="code" href="class_cloth.html#a77d2938ecfb108321be9d5252a147117" title="cloth width">mWidth</a> = 10.0f;         <span class="comment">//5</span>
<a name="l00010"></a>00010     <a class="code" href="class_cloth.html#a708b4b915911e7c74bc65ae0b0b734f2" title="cloth height">mHeight</a> = 10.0f;        <span class="comment">//5</span>
<a name="l00011"></a>00011 }
<a name="l00012"></a>00012 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00013"></a><a class="code" href="class_cloth.html#ac55614c4a95de2faab95a3e8e8c8aa28">00013</a> <a class="code" href="class_cloth.html#a74849e3c74939d015df740d2586cc0e9" title="Constructor.">Cloth::Cloth</a>(
<a name="l00014"></a>00014             std::string _texture
<a name="l00015"></a>00015             )
<a name="l00016"></a>00016 {
<a name="l00017"></a>00017     <a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a> = 10.0f; <span class="comment">//10 20    60</span>
<a name="l00018"></a>00018     <a class="code" href="class_cloth.html#ab45593ee4b2687538d946c73ddfea492" title="number of vertical mass particles">m_vertParticles</a> = 10.0f; <span class="comment">//10 20    60</span>
<a name="l00019"></a>00019     <a class="code" href="class_cloth.html#a77d2938ecfb108321be9d5252a147117" title="cloth width">mWidth</a> = 5.0f;      <span class="comment">//5</span>
<a name="l00020"></a>00020     <a class="code" href="class_cloth.html#a708b4b915911e7c74bc65ae0b0b734f2" title="cloth height">mHeight</a> = 5.0f;     <span class="comment">//5</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022     <span class="comment">//texture</span>
<a name="l00023"></a>00023     ngl::Texture tex(_texture);
<a name="l00024"></a>00024     <a class="code" href="class_cloth.html#a8082f75ab41e63b44a613c4b0b776c04" title="cloth texture id">m_textureID</a>=tex.setTextureGL();
<a name="l00025"></a>00025     <a class="code" href="class_bounding_box.html">BoundingBox</a> bb;
<a name="l00026"></a>00026         bb.<a class="code" href="class_bounding_box.html#a258947af38a1fd2be5cfd748702b38cd">m_minx</a> = bb.<a class="code" href="class_bounding_box.html#afac5177c4ec0e7fabc16eab1cdbdfafe">m_miny</a> = bb.<a class="code" href="class_bounding_box.html#a0261ebe3220714d53be827803e72dbc2">m_minz</a> = -10.0;
<a name="l00027"></a>00027         bb.<a class="code" href="class_bounding_box.html#accac5d66b22d132a94935c079ee25b40">m_maxx</a> = bb.<a class="code" href="class_bounding_box.html#a645ee20e05db317741f7c72e0f35da31">m_maxy</a> = bb.<a class="code" href="class_bounding_box.html#a8e35ea84f95c8adaa0c68add6df2c0d3">m_maxz</a> = 10.0;
<a name="l00028"></a>00028         <a class="code" href="class_cloth.html#ac8ddf555eb178ab5aec3675446d991d4" title="octree for collision detection">collisionTree</a> = <span class="keyword">new</span> <a class="code" href="class_particle_octree.html">ParticleOctree</a> (4, bb); <span class="comment">// control the height of the octree</span>
<a name="l00029"></a>00029         <a class="code" href="class_cloth.html#ae060f23b57c590b6afc0f571a44d767e" title="bool to give user the choie of applying octree">m_applyOctree</a> = <span class="keyword">false</span>;
<a name="l00030"></a>00030     <a class="code" href="class_cloth.html#a214dcb56aa2328e4f2d21ab35d76fbaf" title="wind magnitude that can be added via user interface">m_windMag</a> = 0.0;
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00033"></a><a class="code" href="class_cloth.html#a1530e0e5b2495e716092dba6a260da91">00033</a> <a class="code" href="class_cloth.html#a1530e0e5b2495e716092dba6a260da91" title="basket destructor">Cloth::~Cloth</a>()
<a name="l00034"></a>00034 {
<a name="l00035"></a>00035     <span class="comment">//delete m_clothSpring;</span>
<a name="l00036"></a>00036 }
<a name="l00037"></a>00037 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00038"></a><a class="code" href="class_cloth.html#abdd2de6586d933a083b6e3242c7f3f87">00038</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#abdd2de6586d933a083b6e3242c7f3f87" title="method to create the cloth grid and its spring connections">Cloth::createCloth</a>(<span class="keywordtype">double</span> _n, std::string _texture)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040     ngl::Texture tex(_texture);
<a name="l00041"></a>00041     <a class="code" href="class_cloth.html#a8082f75ab41e63b44a613c4b0b776c04" title="cloth texture id">m_textureID</a>=tex.setTextureGL();
<a name="l00042"></a>00042     <a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a> = _n;
<a name="l00043"></a>00043     <a class="code" href="class_cloth.html#ab45593ee4b2687538d946c73ddfea492" title="number of vertical mass particles">m_vertParticles</a> = _n;
<a name="l00044"></a>00044     <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0;
<a name="l00045"></a>00045     <a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.resize(<a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a> * <a class="code" href="class_cloth.html#ab45593ee4b2687538d946c73ddfea492" title="number of vertical mass particles">m_vertParticles</a>);
<a name="l00046"></a>00046     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x =0;x&lt;<a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a>;++x)
<a name="l00047"></a>00047     {
<a name="l00048"></a>00048         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;m_vertParticles;++y)
<a name="l00049"></a>00049         {
<a name="l00050"></a>00050             ngl::Vec3 pos;
<a name="l00051"></a>00051             pos.set(<a class="code" href="class_cloth.html#a77d2938ecfb108321be9d5252a147117" title="cloth width">mWidth</a> *(x/(<span class="keywordtype">float</span>)m_horiParticles)*2,2,<a class="code" href="class_cloth.html#a708b4b915911e7c74bc65ae0b0b734f2" title="cloth height">mHeight</a>*(y/(<span class="keywordtype">float</span>)m_vertParticles)*2);
<a name="l00052"></a>00052             ngl::Vec3 vel;
<a name="l00053"></a>00053             vel.set(0.0f,0.0f,0.0f);
<a name="l00054"></a>00054             <a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.at(y*m_horiParticles+x)=<span class="keyword">new</span> <a class="code" href="class_cloth_particle.html">ClothParticle</a>(pos,vel,1.0f,<span class="keyword">false</span>);
<a name="l00055"></a>00055             <span class="keywordflow">if</span>(<a class="code" href="class_cloth.html#a78b4b9f5ef642c351a5242a8fab4a2fe" title="bool to keep cloth fixed for simulations">m_fix</a> == <span class="keyword">true</span>)
<a name="l00056"></a>00056             {
<a name="l00057"></a>00057                 <span class="keywordflow">if</span>(y==0)
<a name="l00058"></a>00058                 {
<a name="l00059"></a>00059     <span class="comment">//                if ((x == 0) || (x == 4) || (x == 8) || (x== m_horiParticles-9) || (x== m_horiParticles-5) || (x== m_horiParticles-1))</span>
<a name="l00060"></a>00060                       <span class="keywordflow">if</span> ((x == 0) || (x == 1) || (x == 4) || (x == 5) || (x == 8) || (x == 9) ||
<a name="l00061"></a>00061                           (x== m_horiParticles-10) || (x== m_horiParticles-9) || (x== m_horiParticles-6) || (x== m_horiParticles-5) || (x== m_horiParticles-2) || (x== m_horiParticles-1))
<a name="l00062"></a>00062 
<a name="l00063"></a>00063                     {
<a name="l00064"></a>00064                         <a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.at(y*m_horiParticles+x)-&gt;m_fixed = <span class="keyword">true</span>;                       
<a name="l00065"></a>00065                     }
<a name="l00066"></a>00066                 }
<a name="l00067"></a>00067             }
<a name="l00068"></a>00068         }
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">//connections</span>
<a name="l00073"></a>00073     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x =0;x&lt;m_horiParticles;++x)
<a name="l00074"></a>00074     {
<a name="l00075"></a>00075         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;m_vertParticles;++y)
<a name="l00076"></a>00076         {
<a name="l00077"></a>00077             <span class="comment">//structural</span>
<a name="l00078"></a>00078             <span class="keywordflow">if</span> (x&lt;m_horiParticles-1)
<a name="l00079"></a>00079             {
<a name="l00080"></a>00080                 <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +1],0);
<a name="l00081"></a>00081             }
<a name="l00082"></a>00082             <span class="keywordflow">if</span> (y&lt;m_vertParticles-1)
<a name="l00083"></a>00083             {
<a name="l00084"></a>00084                 <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles],0);
<a name="l00085"></a>00085             }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087             <span class="comment">//shear</span>
<a name="l00088"></a>00088             <span class="keywordflow">if</span> (x&lt;m_horiParticles-1 &amp;&amp; y&lt;m_vertParticles-1)
<a name="l00089"></a>00089             {
<a name="l00090"></a>00090                 <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles+1],1);
<a name="l00091"></a>00091                 <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x+1],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles],1);
<a name="l00092"></a>00092             }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094             <span class="comment">//bending</span>
<a name="l00095"></a>00095             <span class="keywordflow">if</span> (x&lt;m_horiParticles-2)
<a name="l00096"></a>00096             { <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x+2],2); }
<a name="l00097"></a>00097             <span class="keywordflow">if</span> (y&lt;m_horiParticles-2)
<a name="l00098"></a>00098             { <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles +m_horiParticles],2); }
<a name="l00099"></a>00099             <span class="keywordflow">if</span> (x&lt;m_horiParticles-2 &amp;&amp; y&lt;m_vertParticles-2)
<a name="l00100"></a>00100             {
<a name="l00101"></a>00101                 <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles +m_horiParticles+2],2);
<a name="l00102"></a>00102                 <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">createSpring</a>(<span class="keywordtype">id</span>++,<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x+2],<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles +m_horiParticles],2);
<a name="l00103"></a>00103             }
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106  }
<a name="l00107"></a>00107 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00108"></a><a class="code" href="class_cloth.html#a0d9edc32dee9ceaead679f3b904262d2">00108</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#a0d9edc32dee9ceaead679f3b904262d2" title="Draw method for drawing the cloth.">Cloth::drawTriCloth</a>(
<a name="l00109"></a>00109                         <span class="keyword">const</span> std::string &amp;_shaderName,
<a name="l00110"></a>00110                       ngl::TransformStack &amp;_transformStack,
<a name="l00111"></a>00111                         ngl::Camera *_cam
<a name="l00112"></a>00112                         )
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <span class="comment">// texture co-ords start at 0,0</span>
<a name="l00115"></a>00115     <span class="comment">// texture steps</span>
<a name="l00116"></a>00116     ngl::Real du=0.9/<a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a>;
<a name="l00117"></a>00117     ngl::Real dv=0.9/<a class="code" href="class_cloth.html#ab45593ee4b2687538d946c73ddfea492" title="number of vertical mass particles">m_vertParticles</a>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     ngl::Real u=0.0;
<a name="l00120"></a>00120     ngl::Real v=0.0;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="comment">// a std::vector to store our verts</span>
<a name="l00123"></a>00123     <a class="code" href="structmass_points.html">massPoints</a> vert;
<a name="l00124"></a>00124     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> x =0;x&lt;<a class="code" href="class_cloth.html#aa9fadb08dbfbd2cdcd795a05b1822b8e" title="number of horizontal mass particles">m_horiParticles</a>-1;++x)
<a name="l00125"></a>00125     {
<a name="l00126"></a>00126         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y=0;y&lt;<a class="code" href="class_cloth.html#ab45593ee4b2687538d946c73ddfea492" title="number of vertical mass particles">m_vertParticles</a>-1;++y)
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128           <span class="comment">/* tri 1</span>
<a name="l00129"></a>00129 <span class="comment">              // counter clock wise</span>
<a name="l00130"></a>00130 <span class="comment">              3</span>
<a name="l00131"></a>00131 <span class="comment">              | \</span>
<a name="l00132"></a>00132 <span class="comment">              |  \</span>
<a name="l00133"></a>00133 <span class="comment">              |   \</span>
<a name="l00134"></a>00134 <span class="comment">              1____2</span>
<a name="l00135"></a>00135 <span class="comment">              */</span>
<a name="l00136"></a>00136               <span class="comment">// the normals are always the same so set them for d first</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138               ngl::Vec3 _vN =calcNormal(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x]-&gt;getPosition(),<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition(),<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles]-&gt;getPosition());
<a name="l00139"></a>00139               vert.<a class="code" href="structmass_points.html#a0b49687782602e90d539fe274cb262ab">nx</a>=_vN.m_x;
<a name="l00140"></a>00140               vert.<a class="code" href="structmass_points.html#a328bdd862b21686f476069538da44d44">ny</a>=_vN.m_y;
<a name="l00141"></a>00141               vert.<a class="code" href="structmass_points.html#a27300220f095c9255c8f219ebecfb329">nz</a>=_vN.m_z;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143               vert.<a class="code" href="structmass_points.html#a70c2beddcf03aedbc956ed0d7ff83c7b">u</a>=u; vert.<a class="code" href="structmass_points.html#a99325e4998c2f3bf9db03ffa0693f40d">v</a>=v+dv;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145               vert.<a class="code" href="structmass_points.html#a1a964651b6791ad84706b981eace6d58">x</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x]-&gt;getPosition().m_x;
<a name="l00146"></a>00146               vert.<a class="code" href="structmass_points.html#a4f761af859df314e544bfd2756eae362">y</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x]-&gt;getPosition().m_y;
<a name="l00147"></a>00147               vert.<a class="code" href="structmass_points.html#a98ff384b495251f4fe6d4fef035da4d6">z</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x]-&gt;getPosition().m_z;
<a name="l00148"></a>00148               <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.push_back(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x]);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150               <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.push_back(vert);
<a name="l00151"></a>00151               <span class="comment">// 2</span>
<a name="l00152"></a>00152               vert.<a class="code" href="structmass_points.html#a70c2beddcf03aedbc956ed0d7ff83c7b">u</a>=u+du; vert.<a class="code" href="structmass_points.html#a99325e4998c2f3bf9db03ffa0693f40d">v</a>=v+dv;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154               vert.<a class="code" href="structmass_points.html#a1a964651b6791ad84706b981eace6d58">x</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition().m_x;
<a name="l00155"></a>00155               vert.<a class="code" href="structmass_points.html#a4f761af859df314e544bfd2756eae362">y</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition().m_y;
<a name="l00156"></a>00156               vert.<a class="code" href="structmass_points.html#a98ff384b495251f4fe6d4fef035da4d6">z</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition().m_z;
<a name="l00157"></a>00157               <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.push_back(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]);
<a name="l00158"></a>00158               <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.push_back(vert);
<a name="l00159"></a>00159               <span class="comment">// 3</span>
<a name="l00160"></a>00160               vert.<a class="code" href="structmass_points.html#a70c2beddcf03aedbc956ed0d7ff83c7b">u</a>=u; vert.<a class="code" href="structmass_points.html#a99325e4998c2f3bf9db03ffa0693f40d">v</a>=v;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162               vert.<a class="code" href="structmass_points.html#a1a964651b6791ad84706b981eace6d58">x</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles]-&gt;getPosition().m_x;
<a name="l00163"></a>00163               vert.<a class="code" href="structmass_points.html#a4f761af859df314e544bfd2756eae362">y</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles]-&gt;getPosition().m_y;
<a name="l00164"></a>00164               vert.<a class="code" href="structmass_points.html#a98ff384b495251f4fe6d4fef035da4d6">z</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles]-&gt;getPosition().m_z;
<a name="l00165"></a>00165               <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.push_back(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x +m_horiParticles]);
<a name="l00166"></a>00166               <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.push_back(vert);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 
<a name="l00169"></a>00169           <span class="comment">/* tri 2 w,0,d</span>
<a name="l00170"></a>00170 <span class="comment">        // counter clock wise</span>
<a name="l00171"></a>00171 <span class="comment">         3_____2</span>
<a name="l00172"></a>00172 <span class="comment">          \    |</span>
<a name="l00173"></a>00173 <span class="comment">            \  |</span>
<a name="l00174"></a>00174 <span class="comment">             \ |</span>
<a name="l00175"></a>00175 <span class="comment">              \|</span>
<a name="l00176"></a>00176 <span class="comment">              1</span>
<a name="l00177"></a>00177 <span class="comment"></span>
<a name="l00178"></a>00178 <span class="comment">              */</span>
<a name="l00179"></a>00179               vert.<a class="code" href="structmass_points.html#a0b49687782602e90d539fe274cb262ab">nx</a>=_vN.m_x;
<a name="l00180"></a>00180               vert.<a class="code" href="structmass_points.html#a328bdd862b21686f476069538da44d44">ny</a>=_vN.m_y;
<a name="l00181"></a>00181               vert.<a class="code" href="structmass_points.html#a27300220f095c9255c8f219ebecfb329">nz</a>=_vN.m_z;
<a name="l00182"></a>00182               vert.<a class="code" href="structmass_points.html#a70c2beddcf03aedbc956ed0d7ff83c7b">u</a>=u+du; vert.<a class="code" href="structmass_points.html#a99325e4998c2f3bf9db03ffa0693f40d">v</a>=v+dv;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184               vert.<a class="code" href="structmass_points.html#a1a964651b6791ad84706b981eace6d58">x</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition().m_x;
<a name="l00185"></a>00185               vert.<a class="code" href="structmass_points.html#a4f761af859df314e544bfd2756eae362">y</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition().m_y;
<a name="l00186"></a>00186               vert.<a class="code" href="structmass_points.html#a98ff384b495251f4fe6d4fef035da4d6">z</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]-&gt;getPosition().m_z;
<a name="l00187"></a>00187               <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.push_back(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + 1]);
<a name="l00188"></a>00188               <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.push_back(vert);
<a name="l00189"></a>00189               <span class="comment">// 2</span>
<a name="l00190"></a>00190               vert.<a class="code" href="structmass_points.html#a70c2beddcf03aedbc956ed0d7ff83c7b">u</a>=u+du; vert.<a class="code" href="structmass_points.html#a99325e4998c2f3bf9db03ffa0693f40d">v</a>=v;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192               vert.<a class="code" href="structmass_points.html#a1a964651b6791ad84706b981eace6d58">x</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles +1]-&gt;getPosition().m_x;
<a name="l00193"></a>00193               vert.<a class="code" href="structmass_points.html#a4f761af859df314e544bfd2756eae362">y</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles +1]-&gt;getPosition().m_y;
<a name="l00194"></a>00194               vert.<a class="code" href="structmass_points.html#a98ff384b495251f4fe6d4fef035da4d6">z</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles +1]-&gt;getPosition().m_z;
<a name="l00195"></a>00195               <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.push_back(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles +1]);
<a name="l00196"></a>00196               <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.push_back(vert);
<a name="l00197"></a>00197               <span class="comment">// 3</span>
<a name="l00198"></a>00198               vert.<a class="code" href="structmass_points.html#a70c2beddcf03aedbc956ed0d7ff83c7b">u</a>=u; vert.<a class="code" href="structmass_points.html#a99325e4998c2f3bf9db03ffa0693f40d">v</a>=v;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200               vert.<a class="code" href="structmass_points.html#a1a964651b6791ad84706b981eace6d58">x</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles]-&gt;getPosition().m_x;
<a name="l00201"></a>00201               vert.<a class="code" href="structmass_points.html#a4f761af859df314e544bfd2756eae362">y</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles]-&gt;getPosition().m_y;
<a name="l00202"></a>00202               vert.<a class="code" href="structmass_points.html#a98ff384b495251f4fe6d4fef035da4d6">z</a>=<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles]-&gt;getPosition().m_z;
<a name="l00203"></a>00203               <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.push_back(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[y*m_horiParticles+x + m_horiParticles]);
<a name="l00204"></a>00204               <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.push_back(vert);
<a name="l00205"></a>00205             u+=du;
<a name="l00206"></a>00206           } <span class="comment">// end w loop</span>
<a name="l00207"></a>00207           u=0.0;
<a name="l00208"></a>00208           v+=du;
<a name="l00209"></a>00209       } <span class="comment">// end d loop</span>
<a name="l00210"></a>00210       <span class="comment">// now create the VBO</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00213"></a>00213         glEnable (GL_BLEND);
<a name="l00214"></a>00214         glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
<a name="l00215"></a>00215         shader-&gt;use(_shaderName);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217         ngl::VertexArrayObject *vao_tri = ngl::VertexArrayObject::createVOA(GL_TRIANGLES);
<a name="l00218"></a>00218         vao_tri-&gt;bind();
<a name="l00219"></a>00219         vao_tri-&gt;setData(<a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.size()*<span class="keyword">sizeof</span>(<a class="code" href="structmass_points.html">massPoints</a>),<a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>[0].u);
<a name="l00220"></a>00220         vao_tri-&gt;setVertexAttributePointer(0,3,GL_FLOAT,<span class="keyword">sizeof</span>(<a class="code" href="structmass_points.html">massPoints</a>),5);
<a name="l00221"></a>00221         vao_tri-&gt;setVertexAttributePointer(1,2,GL_FLOAT,<span class="keyword">sizeof</span>(<a class="code" href="structmass_points.html">massPoints</a>),0);
<a name="l00222"></a>00222         vao_tri-&gt;setVertexAttributePointer(2,3,GL_FLOAT,<span class="keyword">sizeof</span>(<a class="code" href="structmass_points.html">massPoints</a>),2);
<a name="l00223"></a>00223         vao_tri-&gt;setNumIndices(<a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.size());
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         glBindTexture(GL_TEXTURE_2D,<a class="code" href="class_cloth.html#a8082f75ab41e63b44a613c4b0b776c04" title="cloth texture id">m_textureID</a>);
<a name="l00226"></a>00226         <a class="code" href="class_cloth.html#aae971ca955a907ea2e76cf9b8e9b7c55" title="load all the transform values to the shader">loadMatricesToShader</a>(_transformStack,_cam);
<a name="l00227"></a>00227         vao_tri-&gt;draw();
<a name="l00228"></a>00228         vao_tri-&gt;unbind();
<a name="l00229"></a>00229     glDisable(GL_BLEND);
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00232"></a><a class="code" href="class_cloth.html#a03d78189c0af51a22b1d06152c52c8d6">00232</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#a03d78189c0af51a22b1d06152c52c8d6">Cloth::drawSpring</a>(ngl::Vec3 _vertA, ngl::Vec3 _vertB,<span class="keywordtype">int</span> _sptype)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     std::vector &lt;ngl::Vec3&gt; points(2);
<a name="l00235"></a>00235     points[0] = _vertA;
<a name="l00236"></a>00236     points[1] = _vertB;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     ngl::VertexArrayObject *vaoSpring = ngl::VertexArrayObject::createVOA(GL_LINES);
<a name="l00239"></a>00239     vaoSpring-&gt;bind();
<a name="l00240"></a>00240     vaoSpring-&gt;setData(2*<span class="keyword">sizeof</span>(ngl::Vec3),points[0].m_x);
<a name="l00241"></a>00241     vaoSpring-&gt;setNumIndices(2);
<a name="l00242"></a>00242     vaoSpring-&gt;setVertexAttributePointer(0,3,GL_FLOAT,0,0);
<a name="l00243"></a>00243     vaoSpring-&gt;draw();
<a name="l00244"></a>00244     vaoSpring-&gt;unbind();
<a name="l00245"></a>00245     <span class="keyword">delete</span> vaoSpring;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00248"></a><a class="code" href="class_cloth.html#a213f8c391b3a666177c58dc4ca4994c4">00248</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#a03d78189c0af51a22b1d06152c52c8d6">Cloth::drawSpring</a>(<a class="code" href="class_cloth_spring.html">ClothSpring</a> _cs)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250     std::vector &lt;ngl::Vec3&gt; points(2);
<a name="l00251"></a>00251     points[0] = _cs.<a class="code" href="class_cloth_spring.html#a8c797989f9629eedead0a5a03c38ccbd" title="method to get the position of cloth particle at end A from the integrator">getPositionA</a>();
<a name="l00252"></a>00252     points[1] = _cs.<a class="code" href="class_cloth_spring.html#ae990bff22ea49f1b2169dfc9129b16cb" title="method to get the position of cloth particle at end B from the integrator">getPositionB</a>();
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     ngl::VertexArrayObject *vaoSpring = ngl::VertexArrayObject::createVOA(GL_LINES);
<a name="l00255"></a>00255     vaoSpring-&gt;bind();
<a name="l00256"></a>00256     vaoSpring-&gt;setData(2*<span class="keyword">sizeof</span>(ngl::Vec3),points[0].m_x);
<a name="l00257"></a>00257     vaoSpring-&gt;setNumIndices(2);
<a name="l00258"></a>00258     vaoSpring-&gt;setVertexAttributePointer(0,3,GL_FLOAT,0,0);
<a name="l00259"></a>00259     vaoSpring-&gt;draw();
<a name="l00260"></a>00260     vaoSpring-&gt;unbind();
<a name="l00261"></a>00261     <span class="keyword">delete</span> vaoSpring;
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00264"></a><a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">00264</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#a15ed669daa76271204a59fedde127868">Cloth::createSpring</a>(<span class="keywordtype">int</span> _id, <a class="code" href="class_cloth_particle.html">ClothParticle</a>* _vertA, <a class="code" href="class_cloth_particle.html">ClothParticle</a>* _vertB,<span class="keywordtype">int</span> _sptype)
<a name="l00265"></a>00265 {
<a name="l00266"></a>00266      <a class="code" href="class_cloth_spring.html">ClothSpring</a> cs(_id, _vertA, _vertB, 300.0f, 3.0f,_sptype); <span class="comment">//40 , 1.0  150,2 (300-3 stable like a light fab)</span>
<a name="l00267"></a>00267      <a class="code" href="class_cloth.html#ae2aeb11b90b86c1ea9060a7bc2c2a5e2" title="vector containg all the springs in the cloth">m_clothSpringArr</a>.push_back(cs);
<a name="l00268"></a>00268 }
<a name="l00269"></a>00269 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00270"></a><a class="code" href="class_cloth.html#ad26926a8404ce36de4a540c38903a6b3">00270</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#ad26926a8404ce36de4a540c38903a6b3" title="method to update the cloth- forces(internal and external) and update the mass particles...">Cloth::updateCloth</a>()
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <span class="comment">// 1- spring forces</span>
<a name="l00273"></a>00273     <span class="keywordflow">for</span>(std::vector&lt;ClothSpring&gt;::size_type i=0;i&lt;<a class="code" href="class_cloth.html#ae2aeb11b90b86c1ea9060a7bc2c2a5e2" title="vector containg all the springs in the cloth">m_clothSpringArr</a>.size();++i)
<a name="l00274"></a>00274     {
<a name="l00275"></a>00275         <span class="comment">//springforces- cal forces exerted by spring on both the particles</span>
<a name="l00276"></a>00276         <span class="comment">//store tht in the force variable of particles</span>
<a name="l00277"></a>00277         <a class="code" href="class_cloth.html#ae2aeb11b90b86c1ea9060a7bc2c2a5e2" title="vector containg all the springs in the cloth">m_clothSpringArr</a>[i].m_posA-&gt;m_force+=(<a class="code" href="class_cloth.html#ae2aeb11b90b86c1ea9060a7bc2c2a5e2" title="vector containg all the springs in the cloth">m_clothSpringArr</a>[i].calSpringForces()*-1.0);
<a name="l00278"></a>00278         <a class="code" href="class_cloth.html#ae2aeb11b90b86c1ea9060a7bc2c2a5e2" title="vector containg all the springs in the cloth">m_clothSpringArr</a>[i].m_posB-&gt;m_force+=<a class="code" href="class_cloth.html#ae2aeb11b90b86c1ea9060a7bc2c2a5e2" title="vector containg all the springs in the cloth">m_clothSpringArr</a>[i].calSpringForces();
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     <span class="comment">// 2 - gravity and update using RK4</span>
<a name="l00282"></a>00282     <span class="keywordflow">for</span>(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.size();++i)
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284         <a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;applyGravity();
<a name="l00285"></a>00285         <a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;update();
<a name="l00286"></a>00286         <a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]-&gt;m_force.set(0.0f,0.0f,0.0f);
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289     <span class="comment">//3 - self collisions</span>
<a name="l00290"></a>00290     <span class="keywordflow">if</span>(<a class="code" href="class_cloth.html#ae060f23b57c590b6afc0f571a44d767e" title="bool to give user the choie of applying octree">m_applyOctree</a> == <span class="keyword">true</span>)
<a name="l00291"></a>00291     {
<a name="l00292"></a>00292         <a class="code" href="class_cloth.html#acdcb21d1a164861da55d5ff238fff544" title="method to check for self collision detection between cloth mass particles to prevent...">collisionWithBalls</a>();
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294     <span class="comment">//clear the verdata for drawing</span>
<a name="l00295"></a>00295     <a class="code" href="class_cloth.html#a3a98452fbbb8f4adab213e046f694c6c" title="mass point vertices data - for drawing the triangulated cloth mesh">m_vertData</a>.clear();
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00298"></a><a class="code" href="class_cloth.html#aae971ca955a907ea2e76cf9b8e9b7c55">00298</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#aae971ca955a907ea2e76cf9b8e9b7c55" title="load all the transform values to the shader">Cloth::loadMatricesToShader</a>(
<a name="l00299"></a>00299                                     ngl::TransformStack &amp;_tx,
<a name="l00300"></a>00300                                     ngl::Camera *_cam
<a name="l00301"></a>00301                                   )<span class="keyword"> const</span>
<a name="l00302"></a>00302 <span class="keyword"></span>{
<a name="l00303"></a>00303     ngl::ShaderLib *shader=ngl::ShaderLib::instance();
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     ngl::Mat4 MV;
<a name="l00306"></a>00306     ngl::Mat4 MVP;
<a name="l00307"></a>00307     MV=_tx.getCurrAndGlobal().getMatrix()*_cam-&gt;getViewMatrix() ;
<a name="l00308"></a>00308     MVP=MV*_cam-&gt;getProjectionMatrix();
<a name="l00309"></a>00309     shader-&gt;setShaderParamFromMat4(<span class="stringliteral">&quot;MVP&quot;</span>,MVP);
<a name="l00310"></a>00310 }
<a name="l00311"></a>00311 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00312"></a><a class="code" href="class_cloth.html#acdcb21d1a164861da55d5ff238fff544">00312</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#acdcb21d1a164861da55d5ff238fff544" title="method to check for self collision detection between cloth mass particles to prevent...">Cloth::collisionWithBalls</a>()
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314     <a class="code" href="class_cloth.html#ac8ddf555eb178ab5aec3675446d991d4" title="octree for collision detection">collisionTree</a>-&gt;<a class="code" href="class_abstract_octree.html#a6b57da99d6ae9154ab6183a96655759b" title="clear off all the Ts from the tree">clearTree</a>();
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="comment">//    for(std::list&lt;ClothParticle *&gt;::iterator itr = m_massVert.begin(); itr!= m_massVert.end(); ++itr)</span>
<a name="l00317"></a>00317 <span class="comment">//    {</span>
<a name="l00318"></a>00318         <span class="keywordflow">for</span>(std::vector&lt;ClothParticle *&gt;::size_type i=0;i&lt;<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>.size()-1;++i)
<a name="l00319"></a>00319         {
<a name="l00320"></a>00320 
<a name="l00321"></a>00321             <a class="code" href="class_cloth.html#ac8ddf555eb178ab5aec3675446d991d4" title="octree for collision detection">collisionTree</a>-&gt;<a class="code" href="class_abstract_octree.html#aa12fa4d09ef005992b61bf9853478c4f" title="add a T into the tree, add the partile to all the leaves collide with">addObject</a>(<a class="code" href="class_cloth.html#add1ba761667b31248900268047a09065" title="vector array for the cloth&amp;#39;s mass particles">m_massVert</a>[i]);
<a name="l00322"></a>00322     }
<a name="l00323"></a>00323     <a class="code" href="class_cloth.html#ac8ddf555eb178ab5aec3675446d991d4" title="octree for collision detection">collisionTree</a>-&gt;<a class="code" href="class_abstract_octree.html#a5b6dc329a11f2cead34659007f8c62a6" title="check the collision for the Ts in each leaves">checkCollision</a>();
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00326"></a><a class="code" href="class_cloth.html#a98c53cc7b566cb175e25185e1355c503">00326</a> <span class="keywordtype">void</span> <a class="code" href="class_cloth.html#a98c53cc7b566cb175e25185e1355c503">Cloth::applyWindForce</a>()
<a name="l00327"></a>00327 {
<a name="l00328"></a>00328     <span class="comment">//6- wind forces</span>
<a name="l00329"></a>00329      <span class="keywordflow">for</span>(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;<a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>.size();i+=3)
<a name="l00330"></a>00330      {
<a name="l00331"></a>00331          ngl::Vec3 nor,d,direction;
<a name="l00332"></a>00332          ngl::Vec3 p1 = <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>[i]-&gt;getPosition();
<a name="l00333"></a>00333          ngl::Vec3 p2 = <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>[i+1]-&gt;getPosition();
<a name="l00334"></a>00334          ngl::Vec3 p3 = <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>[i+2]-&gt;getPosition();
<a name="l00335"></a>00335         <span class="comment">// std::cout&lt;&lt;i&lt;&lt;&quot;: p1= &quot;&lt;&lt;p1&lt;&lt;&quot;\t p2=&quot;&lt;&lt;p2&lt;&lt;&quot;\t p3 =&quot;&lt;&lt;p3&lt;&lt;std::endl;</span>
<a name="l00336"></a>00336 
<a name="l00337"></a>00337          nor = calcNormal(p1,p2,p3);
<a name="l00338"></a>00338          <span class="comment">//nor.normalize();</span>
<a name="l00339"></a>00339          <span class="comment">//d.set((nor.normalize();));</span>
<a name="l00340"></a>00340 
<a name="l00341"></a>00341          ngl::Vec3 wind;
<a name="l00342"></a>00342          wind.set(0.001,0,-0.001);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344          wind.m_x += <a class="code" href="class_cloth.html#a214dcb56aa2328e4f2d21ab35d76fbaf" title="wind magnitude that can be added via user interface">m_windMag</a>;
<a name="l00345"></a>00345          wind.m_z += <a class="code" href="class_cloth.html#a214dcb56aa2328e4f2d21ab35d76fbaf" title="wind magnitude that can be added via user interface">m_windMag</a>;
<a name="l00346"></a>00346          direction.set(wind);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348          ngl::Vec3 f = nor*direction;
<a name="l00349"></a>00349          <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>[i]-&gt;m_force+=f;
<a name="l00350"></a>00350          <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>[i+1]-&gt;m_force+=f;
<a name="l00351"></a>00351          <a class="code" href="class_cloth.html#ab1c7dfb259e4f47610545828241dce44" title="vector array for the cloth&amp;#39;s mass particles stored as a traingular mesh">m_triArray</a>[i+2]-&gt;m_force+=f;
<a name="l00352"></a>00352      }
<a name="l00353"></a>00353 }
<a name="l00354"></a>00354 
<a name="l00355"></a>00355 <span class="comment">//----------------------------------------------------------------------------------------------------------------------</span>
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">//    for(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;m_massVert.size();++i)</span>
<a name="l00358"></a>00358 <span class="comment">//    {</span>
<a name="l00359"></a>00359 <span class="comment">//        //cloth particle position</span>
<a name="l00360"></a>00360 <span class="comment">//        ngl::Vec3 cpPos = m_massVert[i]-&gt;m_pos;</span>
<a name="l00361"></a>00361 <span class="comment">//        //cloth particle velocity</span>
<a name="l00362"></a>00362 <span class="comment">//        ngl::Vec3 cpVel = m_massVert[i]-&gt;m_vel;</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">//        relPos = (cpPos - sPos);</span>
<a name="l00365"></a>00365 <span class="comment">//        //distance</span>
<a name="l00366"></a>00366 <span class="comment">//        len = abs(relPos.length());</span>
<a name="l00367"></a>00367 <span class="comment">//        if(len &lt;= minDist)</span>
<a name="l00368"></a>00368 <span class="comment">//        {</span>
<a name="l00369"></a>00369 <span class="comment">//            //collision</span>
<a name="l00370"></a>00370 <span class="comment">//            relPos.normalize();</span>
<a name="l00371"></a>00371 <span class="comment">//            m_massVert[i]-&gt;m_pos += relPos*(minDist-len);</span>
<a name="l00372"></a>00372 <span class="comment">//            m_massVert[i]-&gt;m_vel = -cpVel.dot(relPos)*relPos+(cpVel-cpVel.dot(relPos)*relPos);</span>
<a name="l00373"></a>00373 <span class="comment">//            //m_cloth-&gt;m_massVert[i]-&gt;m_pos.set(2,2,2);</span>
<a name="l00374"></a>00374 <span class="comment">//        }</span>
<a name="l00375"></a>00375 <span class="comment">//     }</span>
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="comment">//updating the position acc to change in velocity</span>
<a name="l00378"></a>00378 <span class="comment">//    for(std::vector&lt;ngl::Vec3&gt;::size_type i=0;i&lt;m_massVert.size();++i)</span>
<a name="l00379"></a>00379 <span class="comment">//    {</span>
<a name="l00380"></a>00380 <span class="comment">//        //cloth particle position</span>
<a name="l00381"></a>00381 <span class="comment">//        ngl::Vec3 cpPos = m_massVert[i]-&gt;m_pos;</span>
<a name="l00382"></a>00382 <span class="comment">//        //cloth particle velocity</span>
<a name="l00383"></a>00383 <span class="comment">//        ngl::Vec3 cpVel = m_massVert[i]-&gt;m_vel;</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="comment">//        relPos = (cpPos - sPos);</span>
<a name="l00386"></a>00386 <span class="comment">//        //distance</span>
<a name="l00387"></a>00387 <span class="comment">//        len = relPos.length();</span>
<a name="l00388"></a>00388 <span class="comment">//        if(len &lt;= minDist)</span>
<a name="l00389"></a>00389 <span class="comment">//        {</span>
<a name="l00390"></a>00390 <span class="comment">//            //collision</span>
<a name="l00391"></a>00391 <span class="comment">//            relPos.normalize();</span>
<a name="l00392"></a>00392 <span class="comment">//            m_massVert[i]-&gt;m_pos += relPos*(minDist-len);</span>
<a name="l00393"></a>00393 <span class="comment">//            //m_massVert[i]-&gt;m_vel = -cpVel.dot(relPos)*relPos+(cpVel-cpVel.dot(relPos)*relPos);</span>
<a name="l00394"></a>00394 <span class="comment">//            //m_cloth-&gt;m_massVert[i]-&gt;m_pos.set(2,2,2);</span>
<a name="l00395"></a>00395 <span class="comment">//        }</span>
<a name="l00396"></a>00396 <span class="comment">//        //p=p+v</span>
<a name="l00397"></a>00397 <span class="comment">//       if(m_massVert[i]-&gt;m_fixed == false)</span>
<a name="l00398"></a>00398 <span class="comment">//       {</span>
<a name="l00399"></a>00399 <span class="comment">//           m_massVert[i]-&gt;m_pos+=m_gravity;</span>
<a name="l00400"></a>00400 <span class="comment">//           m_massVert[i]-&gt;m_pos+=m_massVert[i]-&gt;m_vel;</span>
<a name="l00401"></a>00401 <span class="comment">//           //std::cout&lt;&lt;&quot;\n m_massVert[&quot;&lt;&lt;i&lt;&lt;&quot;]-&gt;m_pos = &quot;&lt;&lt;m_massVert[i]-&gt;m_pos&lt;&lt;&quot; m_massVert[i]-&gt;m_vel = &quot;&lt;&lt;m_massVert[i]-&gt;m_vel;</span>
<a name="l00402"></a>00402 <span class="comment">//           //std::cout&lt;&lt;&quot;\n m_massVert[10]-&gt;m_pos = &quot;&lt;&lt;m_massVert[10]-&gt;m_pos&lt;&lt;&quot; m_massVert[10]-&gt;m_vel = &quot;&lt;&lt;m_massVert[10]-&gt;m_vel;</span>
<a name="l00403"></a>00403 <span class="comment">//           m_massVert[i]-&gt;m_vel.set(0.0f,0.0f,0.0f);</span>
<a name="l00404"></a>00404 <span class="comment">//       }</span>
<a name="l00405"></a>00405 <span class="comment">//    }</span>
<a name="l00406"></a>00406 
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="comment">//std::cout&lt;&lt;&quot;\n dont with one loop call;&quot;;</span>
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="comment">/*void Cloth::drawGrid()</span>
<a name="l00414"></a>00414 <span class="comment">{</span>
<a name="l00415"></a>00415 <span class="comment">    //cloth spring instance</span>
<a name="l00416"></a>00416 <span class="comment">    //m_clothSpring = new ClothSpring();</span>
<a name="l00417"></a>00417 <span class="comment"></span>
<a name="l00418"></a>00418 <span class="comment"></span>
<a name="l00419"></a>00419 <span class="comment">    std::vector &lt;massPoints&gt; m_data;</span>
<a name="l00420"></a>00420 <span class="comment">    massPoints vert;</span>
<a name="l00421"></a>00421 <span class="comment">    //resting length of the spring will the step size for our cloth grid</span>
<a name="l00422"></a>00422 <span class="comment">    //float step = m_clothSpring-&gt;getRestLength();</span>
<a name="l00423"></a>00423 <span class="comment">    float step = 10.0f;</span>
<a name="l00424"></a>00424 <span class="comment">    float _length = 10.0f;</span>
<a name="l00425"></a>00425 <span class="comment">    float _width  = 10.0f;</span>
<a name="l00426"></a>00426 <span class="comment">    std::cout&lt;&lt;&quot;\n in createCloth(): springs rest length = &quot;&lt;&lt;step;</span>
<a name="l00427"></a>00427 <span class="comment"></span>
<a name="l00428"></a>00428 <span class="comment">    //length - step size for each grid value</span>
<a name="l00429"></a>00429 <span class="comment">    float lstep  = _length/step;</span>
<a name="l00430"></a>00430 <span class="comment">    float lstep2 = _length/2.0f;</span>
<a name="l00431"></a>00431 <span class="comment">    float v1=-lstep2;</span>
<a name="l00432"></a>00432 <span class="comment"></span>
<a name="l00433"></a>00433 <span class="comment">    //width - step size</span>
<a name="l00434"></a>00434 <span class="comment">    float wstep  = _width/step;</span>
<a name="l00435"></a>00435 <span class="comment">    float wstep2 = _width/2.0f;</span>
<a name="l00436"></a>00436 <span class="comment">    float v2=-wstep2;</span>
<a name="l00437"></a>00437 <span class="comment"></span>
<a name="l00438"></a>00438 <span class="comment">    for(int i=0;i&lt;=step;++i)</span>
<a name="l00439"></a>00439 <span class="comment">    {</span>
<a name="l00440"></a>00440 <span class="comment">        //changing the y value</span>
<a name="l00441"></a>00441 <span class="comment">        //vertex - 1</span>
<a name="l00442"></a>00442 <span class="comment">        vert.x=-lstep2; //x</span>
<a name="l00443"></a>00443 <span class="comment">        vert.y= v1; //y</span>
<a name="l00444"></a>00444 <span class="comment">        vert.z= 0.0f;   //z</span>
<a name="l00445"></a>00445 <span class="comment">        m_data.push_back(vert);</span>
<a name="l00446"></a>00446 <span class="comment">        //vertex - 2</span>
<a name="l00447"></a>00447 <span class="comment">        vert.x=lstep2;  //x</span>
<a name="l00448"></a>00448 <span class="comment">        vert.y=v1;  //y</span>
<a name="l00449"></a>00449 <span class="comment">        m_data.push_back(vert);</span>
<a name="l00450"></a>00450 <span class="comment"></span>
<a name="l00451"></a>00451 <span class="comment">        //changing the x value</span>
<a name="l00452"></a>00452 <span class="comment">        //vertex - 1</span>
<a name="l00453"></a>00453 <span class="comment">        vert.x=v2; //x</span>
<a name="l00454"></a>00454 <span class="comment">        vert.y= wstep2; //y</span>
<a name="l00455"></a>00455 <span class="comment">        m_data.push_back(vert);</span>
<a name="l00456"></a>00456 <span class="comment">        //vertex - 2</span>
<a name="l00457"></a>00457 <span class="comment">        vert.x=v2; //x</span>
<a name="l00458"></a>00458 <span class="comment">        vert.y=-wstep2; //y</span>
<a name="l00459"></a>00459 <span class="comment">        m_data.push_back(vert);</span>
<a name="l00460"></a>00460 <span class="comment"></span>
<a name="l00461"></a>00461 <span class="comment">        //change in step value</span>
<a name="l00462"></a>00462 <span class="comment">        v1+=lstep;</span>
<a name="l00463"></a>00463 <span class="comment">        v2+=wstep;</span>
<a name="l00464"></a>00464 <span class="comment">        //std::cout&lt;&lt;&quot;\nvert.x = &quot;&lt;&lt;vert.x;</span>
<a name="l00465"></a>00465 <span class="comment">    }</span>
<a name="l00466"></a>00466 <span class="comment"></span>
<a name="l00467"></a>00467 <span class="comment">    ngl::VertexArrayObject *vao_cloth = ngl::VertexArrayObject::createVOA(GL_LINES);</span>
<a name="l00468"></a>00468 <span class="comment">    vao_cloth-&gt;bind();</span>
<a name="l00469"></a>00469 <span class="comment">    vao_cloth-&gt;setData(m_data.size()*sizeof(massPoints),m_data[0].u);</span>
<a name="l00470"></a>00470 <span class="comment">    vao_cloth-&gt;setVertexAttributePointer(0,3,GL_FLOAT,sizeof(massPoints),5);</span>
<a name="l00471"></a>00471 <span class="comment">    vao_cloth-&gt;setVertexAttributePointer(1,2,GL_FLOAT,sizeof(massPoints),0);</span>
<a name="l00472"></a>00472 <span class="comment">    vao_cloth-&gt;setVertexAttributePointer(2,3,GL_FLOAT,sizeof(massPoints),2);</span>
<a name="l00473"></a>00473 <span class="comment">    vao_cloth-&gt;setNumIndices(m_data.size());</span>
<a name="l00474"></a>00474 <span class="comment">    vao_cloth-&gt;draw();</span>
<a name="l00475"></a>00475 <span class="comment">    vao_cloth-&gt;unbind();</span>
<a name="l00476"></a>00476 <span class="comment">}</span>
<a name="l00477"></a>00477 <span class="comment">*/</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 10 May 2013 for ClothSimulation by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
